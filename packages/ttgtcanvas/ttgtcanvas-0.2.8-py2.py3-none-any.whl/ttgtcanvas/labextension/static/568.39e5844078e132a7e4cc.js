(self.webpackChunkttgtcanvas=self.webpackChunkttgtcanvas||[]).push([[568],{1568:(e,t,n)=>{e.exports=n(1367),e.exports.version=n(306).version},7795:(e,t,n)=>{var o=n(1337),i=n(5431),s=n(4827);const{default:r}=n(8524),a=new r({concurrency:1});var l=o.DOMWidgetModel.extend({defaults:i.extend(o.DOMWidgetModel.prototype.defaults(),{_model_name:"MazeModel",_view_name:"MazeView",_model_module:"ttgtcanvas",_view_module:"ttgtcanvas",_model_module_version:"0.2.6",_view_module_version:"0.2.6",current_call:"{}",method_return:"{}"})});const d=function(e,t,n,o,i,r,a){let l=.6*r,d=new s.Circle({radius:l,x:o,y:i,fill:"yellow",stroke:"orange",strokeWidth:5,name:`beeper-${t}-${n}-circle`}),h=new s.Text({text:a,x:o-5,y:i-7,fontSize:18,name:`beeper-${t}-${n}-text`});e.add(d,h)};class h{constructor(e){Object.assign(this,e),this.points=[],this.trace_enabled=!1,this.traceColor="black",this.trace=null,this.pending_moves=[],this.delay=.2,this.angle=0,this.rotation_diff={0:{x:-15,y:-15},"-90":{x:-15,y:15},"-180":{x:15,y:15},"-270":{x:15,y:-15}}}set_image(e,t){return new Promise(((e,n)=>{let o=this;new s.Image.fromURL(this.src,(function(n){o.set_node(n),n.setAttrs({x:100,y:100,name:`robot-${t}`}),o.layer.add(n),o.layer.batchDraw(),e(o)}))}))}set_node(e){for(this.node=e;this.pending_moves.length>0;){let[e,t]=this.pending_moves.shift();this.move_to(e,t)}}add_point(e,t){this.points=this.points.concat([e,t])}clear_trace(){this.points=[],this.angle=0,this.line_layer.destroyChildren(),this.line_layer.draw()}enable_trace(){this.trace_enabled=!0}draw_trace(){let e=new s.Line({points:this.points.slice(Math.max(this.points.length-4,0)),stroke:this.traceColor});this.line_layer.add(e),this.line_layer.draw()}rotate_left(){this.node.rotate(-90),this.angle=(this.angle-90)%-360,this.line_layer.draw()}move_to(e,t){if(!this.node)return void this.pending_moves.push([e,t]);let n=this;return new Promise((function(o,i){let r=n.rotation_diff[`${n.angle}`];var a=new s.Animation((function(o){n.node.x(e+r.x),n.node.y(t+r.y)}),n.layer);a.start(),setTimeout(o,1e3*n.delay);let l=n.node.position();l.x===e+r.x&&l.y===e+r.y&&a.stop()})).then((e=>console.log("done",n.delay)))}}var c=o.DOMWidgetView.extend({method_changed:function(){let e=JSON.parse(this.model.get("current_call"));a.add((()=>{let t="function"==typeof this[e.method_name]?this[e.method_name].apply(this,e.params):null;console.log("current_call in promise",e);let n=this;return Promise.resolve(t).then((function(t){let o=JSON.stringify({value:t,cb:+new Date,params:e.params,method:e.method_name});return console.log("setting return",o),n.model.set("method_return",o),n.model.save_changes(),o}))}))},render:function(){this._elem=document.createElement("div"),console.log("ðŸš€ ~ file: maze.js ~ line 218 ~ this._elem",this),this._elem.setAttribute("id","container"),this.layer=new s.Layer,this.line_layer=new s.Layer,this.robots=[],this.el.appendChild(this._elem),this.method_changed(),this.listenTo(this.model,"change:current_call",this.method_changed,this)},add_robot:function(e,t,n,o,i,s){return this.robots[e]?Promise.resolve("robot exists"):(this.robots[e]=new h({layer:this.layer,line_layer:this.line_layer,avenue:n,street:o,orientation:i,beepers:s,src:t}),this.robots[e].set_image(t,e).then((e=>{console.log(e)})))},move_to:function(e,t,n){return this.robots[e].move_to(t,n)},add_point:function(e,t,n){let o=this.robots[e];o&&(o.add_point(t,n),o.draw_trace())},remove_trace:function(e){let t=this.robots[e];t.trace_enabled=!1,t.clear_trace()},set_pause:function(e,t){console.log("pause");let n=this.robots[e];return n&&(n.delay=t),Promise.resolve(t)},set_trace:function(e,t,n,o="blue"){let i=this.robots[e];i.enable_trace(),i.traceColor=o,i.add_point(t,n)},init_robot:function(e){let t=this.robots[e];if(t){for(;0!==t.angle;)t.rotate_left();t.clear_trace()}},add_beeper:function(e,t,n,o,i){d(this.layer,e,t,n,o,this.ts,i)},update_beeper:function(e,t,n){this.layer.find(`.beeper-${e}-${t}-text`).text(n),this.layer.draw()},remove_beeper:function(e,t){let n=this.layer.find(`.beeper-${e}-${t}-circle`),o=this.layer.find(`.beeper-${e}-${t}-text`);n&&n.destroy(),o&&o.destroy(),this.layer.draw()},rotate_left:function(e){this.robots[e].rotate_left()},draw_grid:function(e,t,n,o,i,r,a){this.stage=new s.Stage({container:"container",width:e,height:t}),this.stage.add(this.layer),this.stage.add(this.line_layer),this.ts=i;let l=2*i,h=l+2*i*n,c=t-2*i,_=c-2*i*o;!function(e,t,n,o,i,r){for(let a=1;a<t;a++){let t=o+n*(2*a),l=new s.Line({stroke:"gray",points:[t,r,t,i]}),d=new s.Text({text:a,x:t-2,y:i+n-10});e.add(l),e.add(d)}}(this.layer,n,i,l,c,_),function(e,t,n,o,i,r){for(let a=1;a<t;a++){let t=i-n*(2*a),l=new s.Line({stroke:"gray",points:[o,t,r,t]}),d=new s.Text({text:a,y:t-2,x:o-n+5});e.add(l),e.add(d)}}(this.layer,o,i,l,c,h);let u=new s.Line({stroke:"darkred",points:[l,c,h,c,h,_,l,_],strokeWidth:10,closed:!0});return this.layer.add(u),function(e,t,n,o,i){const r=function(e,t){return[n+i*e,o-i*t]};t.map((function([t,n]){let o=[];o=t%2==0?[...r(t,n-1),...r(t,n+1)]:[...r(t-1,n),...r(t+1,n)];let i=new s.Line({stroke:"darkred",strokeWidth:10,closed:!0,points:o});e.add(i)}))}(this.layer,r,l,c,i),function(e,t,n,o,i){t.map((function(t){let s=t.key[0],r=t.key[1];const[a,l]=[n+i*(2*s-1),o-i*(2*r-1)];let h=t.value;d(e,s,r,a,l,i,h)}))}(this.layer,a,l,c,i),this.layer.draw(),Promise.resolve("done")}});e.exports={MazeModel:l,MazeView:c}},1367:(e,t,n)=>{var o=n(7795);e.exports={...o}},306:e=>{"use strict";e.exports={version:"0.2.6"}}}]);