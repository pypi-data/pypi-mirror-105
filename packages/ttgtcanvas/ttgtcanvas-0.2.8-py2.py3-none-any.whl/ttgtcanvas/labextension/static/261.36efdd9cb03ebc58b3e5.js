(self.webpackChunkttgtcanvas=self.webpackChunkttgtcanvas||[]).push([[261,568],{1568:(e,t,i)=>{e.exports=i(1367),e.exports.version=i(306).version},6261:(e,t,i)=>{var n=i(1568),s=i(1337);e.exports={id:"ttgtcanvas:plugin",requires:[s.IJupyterWidgetRegistry],activate:function(e,t){t.registerWidget({name:"ttgtcanvas",version:n.version,exports:n})},autoStart:!0}},7795:(e,t,i)=>{var n=i(1337),s=i(5431),r=i(4827);const{default:o}=i(8524),a=new o({concurrency:1});var l=n.DOMWidgetModel.extend({defaults:s.extend(n.DOMWidgetModel.prototype.defaults(),{_model_name:"MazeModel",_view_name:"MazeView",_model_module:"ttgtcanvas",_view_module:"ttgtcanvas",_model_module_version:"0.2.7",_view_module_version:"0.2.7",current_call:"{}",method_return:"{}"})});const d=function(e,t,i,n,s,o,a){let l=.6*o,d=new r.Circle({radius:l,x:n,y:s,fill:"yellow",stroke:"orange",strokeWidth:5,name:`beeper-${t}-${i}-circle`}),h=new r.Text({text:a,x:n-5,y:s-7,fontSize:18,name:`beeper-${t}-${i}-text`});e.add(d,h)};class h{constructor(e){Object.assign(this,e),this.points=[],this.trace_enabled=!1,this.traceColor="black",this.trace=null,this.pending_moves=[],this.delay=.2,this.angle=0,this.rotation_diff={0:{x:-15,y:-15},"-90":{x:-15,y:15},"-180":{x:15,y:15},"-270":{x:15,y:-15}}}set_image(e,t){return new Promise(((i,n)=>{let s=this;new r.Image.fromURL(e,(function(n){s.src=e,s.set_node(n),n.setAttrs({x:100,y:100,width:32,height:32,name:`robot-${t}`}),s.layer.add(n),s.layer.batchDraw(),i(s)}))}))}set_node(e){for(this.node=e;this.pending_moves.length>0;){let[e,t]=this.pending_moves.shift();this.move_to(e,t)}}add_point(e,t){this.points=this.points.concat([e,t])}clear_trace(){this.points=[],this.angle=0,this.line_layer.destroyChildren(),this.line_layer.draw()}enable_trace(){this.trace_enabled=!0}draw_trace(){let e=new r.Line({points:this.points.slice(Math.max(this.points.length-4,0)),stroke:this.traceColor});this.line_layer.add(e),this.line_layer.draw()}rotate_left(){this.node.rotate(-90),this.angle=(this.angle-90)%-360,this.line_layer.draw()}move_to(e,t){if(!this.node)return void this.pending_moves.push([e,t]);let i=this;return new Promise((function(n,s){let o=i.rotation_diff[`${i.angle}`];var a=new r.Animation((function(n){i.node.x(e+o.x),i.node.y(t+o.y)}),i.layer);a.start(),setTimeout(n,1e3*i.delay);let l=i.node.position();l.x===e+o.x&&l.y===e+o.y&&a.stop()})).then((e=>console.log("done",i.delay)))}}var c=n.DOMWidgetView.extend({method_changed:function(){let e=JSON.parse(this.model.get("current_call"));a.add((()=>{let t="function"==typeof this[e.method_name]?this[e.method_name].apply(this,e.params):null;console.log("current_call in promise",e);let i=this;return Promise.resolve(t).then((function(t){let n=JSON.stringify({value:t,cb:+new Date,params:e.params,method:e.method_name});return console.log("setting return",n),i.model.set("method_return",n),i.model.save_changes(),n}))}))},render:function(){this._elem=document.createElement("div"),console.log("ðŸš€ ~ file: maze.js ~ line 218 ~ this._elem",this),this._elem.setAttribute("id","container"),this.layer=new r.Layer,this.line_layer=new r.Layer,this.msg_layer=new r.Layer,this.robots=[],this.el.appendChild(this._elem),this.method_changed(),this.listenTo(this.model,"change:current_call",this.method_changed,this)},add_robot:function(e,t,i,n,s,r){let o=this.robots[e];return o&&o.node&&o.node.destroy(),this.robots[e]=new h({layer:this.layer,line_layer:this.line_layer,avenue:i,street:n,orientation:s,beepers:r,src:t}),this.robots[e].set_image(t,e).then((e=>{console.log(e)}))},move_to:function(e,t,i){return this.robots[e].move_to(t,i)},add_point:function(e,t,i){let n=this.robots[e];n&&(n.add_point(t,i),n.draw_trace())},remove_trace:function(e){let t=this.robots[e];t.trace_enabled=!1,t.clear_trace()},set_pause:function(e,t){console.log("pause");let i=this.robots[e];return i&&(i.delay=t),Promise.resolve(t)},set_trace:function(e,t,i,n="blue"){let s=this.robots[e];s.enable_trace(),s.traceColor=n,s.add_point(t,i)},init_robot:function(e){let t=this.robots[e];if(this.delete_msg(),t){for(;0!==t.angle;)t.rotate_left();t.clear_trace()}},add_beeper:function(e,t,i,n,s){d(this.layer,e,t,i,n,this.ts,s)},update_beeper:function(e,t,i){this.layer.find(`.beeper-${e}-${t}-text`).text(i),this.layer.draw()},remove_beeper:function(e,t){let i=this.layer.find(`.beeper-${e}-${t}-circle`),n=this.layer.find(`.beeper-${e}-${t}-text`);i&&i.destroy(),n&&n.destroy(),this.layer.draw()},rotate_left:function(e){this.robots[e].rotate_left()},success_msg:function(e){this.delete_msg();let t=new r.Group({opacity:0,name:"overlay-msg"});var i=new r.Rect({x:60,y:125,width:400,height:200,fill:"white",shadowBlur:10,cornerRadius:10}),n=new r.Circle({radius:40,x:260,y:130,fill:"green",stroke:"green",strokeWidth:5}),s=new r.Text({x:240,y:110,text:"âœ”",align:"center",fontSize:50,fontFamily:"Calibri",fill:"white"});e=new r.Text({x:120,y:200,text:"Congrats, \n Task Completed.",align:"center",fontSize:40,fontFamily:"Calibri",fill:"green"}),t.add(i,n,e,s),this.msg_layer.add(t),new r.Tween({node:t,opacity:1,easing:r.Easings.EaseOut,duration:5}).play()},delete_msg:function(){let e=this.msg_layer.find(".overlay-msg");e&&(e.destroy(),e.draw())},failed_msg:function(e){this.delete_msg();let t=new r.Group({opacity:0,name:"overlay-msg"});var i=new r.Rect({x:60,y:125,width:400,height:200,fill:"white",shadowBlur:10,cornerRadius:10}),n=new r.Circle({radius:40,x:260,y:130,fill:"red",stroke:"red",align:"center",strokeWidth:5}),s=new r.Text({x:247,y:102,text:"x",align:"center",fontSize:50,fontFamily:"Calibri",fill:"white"});e=new r.Text({x:120,y:200,text:"Opps, Task Failed.",align:"center",fontSize:40,fontFamily:"Calibri",fill:"red"}),t.add(i,n,e,s),this.msg_layer.add(t),new r.Tween({node:t,opacity:1,easing:r.Easings.EaseOut,duration:5}).play()},draw_grid:function(e,t,i,n,s,o,a){this._width=e,this._heigth=t,this.stage=new r.Stage({container:"container",width:e,height:t}),this.stage.add(this.layer),this.stage.add(this.line_layer),this.stage.add(this.msg_layer),this.ts=s;let l=2*s,h=l+2*s*i,c=t-2*s,_=c-2*s*n;!function(e,t,i,n,s,o){for(let a=1;a<t;a++){let t=n+i*(2*a),l=new r.Line({stroke:"gray",points:[t,o,t,s]}),d=new r.Text({text:a,x:t-2,y:s+i-10});e.add(l),e.add(d)}}(this.layer,i,s,l,c,_),function(e,t,i,n,s,o){for(let a=1;a<t;a++){let t=s-i*(2*a),l=new r.Line({stroke:"gray",points:[n,t,o,t]}),d=new r.Text({text:a,y:t-2,x:n-i+5});e.add(l),e.add(d)}}(this.layer,n,s,l,c,h);let u=new r.Line({stroke:"darkred",points:[l,c,h,c,h,_,l,_],strokeWidth:10,closed:!0});return this.layer.add(u),function(e,t,i,n,s){const o=function(e,t){return[i+s*e,n-s*t]};t.map((function([t,i]){let n=[];n=t%2==0?[...o(t,i-1),...o(t,i+1)]:[...o(t-1,i),...o(t+1,i)];let s=new r.Line({stroke:"darkred",strokeWidth:10,closed:!0,points:n});e.add(s)}))}(this.layer,o,l,c,s),function(e,t,i,n,s){t.map((function(t){let r=t.key[0],o=t.key[1];const[a,l]=[i+s*(2*r-1),n-s*(2*o-1)];let h=t.value;d(e,r,o,a,l,s,h)}))}(this.layer,a,l,c,s),this.layer.draw(),Promise.resolve("done")}});e.exports={MazeModel:l,MazeView:c}},1367:(e,t,i)=>{var n=i(7795);e.exports={...n}},306:e=>{"use strict";e.exports={version:"0.2.7"}}}]);