(self.webpackChunkttgtcanvas=self.webpackChunkttgtcanvas||[]).push([[261,568],{1568:(e,t,n)=>{e.exports=n(1367),e.exports.version=n(306).version},6261:(e,t,n)=>{var i=n(1568),o=n(1337);e.exports={id:"ttgtcanvas:plugin",requires:[o.IJupyterWidgetRegistry],activate:function(e,t){t.registerWidget({name:"ttgtcanvas",version:i.version,exports:i})},autoStart:!0}},7795:(e,t,n)=>{var i=n(1337),o=n(5431),r=n(4827);const{default:s}=n(8524),a=new s({concurrency:1});var l=i.DOMWidgetModel.extend({defaults:o.extend(i.DOMWidgetModel.prototype.defaults(),{_model_name:"MazeModel",_view_name:"MazeView",_model_module:"ttgtcanvas",_view_module:"ttgtcanvas",_model_module_version:"0.2.6",_view_module_version:"0.2.6",current_call:"{}",method_return:"{}"})});const d=function(e,t,n,i,o,s,a){let l=.6*s,d=new r.Circle({radius:l,x:i,y:o,fill:"yellow",stroke:"orange",strokeWidth:5,name:`beeper-${t}-${n}-circle`}),h=new r.Text({text:a,x:i-5,y:o-7,fontSize:18,name:`beeper-${t}-${n}-text`});e.add(d,h)};class h{constructor(e){Object.assign(this,e),this.points=[],this.trace_enabled=!1,this.traceColor="black",this.trace=null,this.pending_moves=[],this.delay=.2,this.angle=0,this.rotation_diff={0:{x:-15,y:-15},"-90":{x:-15,y:15},"-180":{x:15,y:15},"-270":{x:15,y:-15}}}set_image(e,t){return new Promise(((e,n)=>{let i=this;new r.Image.fromURL(this.src,(function(n){i.set_node(n),n.setAttrs({x:100,y:100,name:`robot-${t}`}),i.layer.add(n),i.layer.batchDraw(),e(i)}))}))}set_node(e){for(this.node=e;this.pending_moves.length>0;){let[e,t]=this.pending_moves.shift();this.move_to(e,t)}}add_point(e,t){this.points=this.points.concat([e,t])}clear_trace(){this.points=[],this.angle=0,this.line_layer.destroyChildren(),this.line_layer.draw()}enable_trace(){this.trace_enabled=!0}draw_trace(){let e=new r.Line({points:this.points.slice(Math.max(this.points.length-4,0)),stroke:this.traceColor});this.line_layer.add(e),this.line_layer.draw()}rotate_left(){this.node.rotate(-90),this.angle=(this.angle-90)%-360,this.line_layer.draw()}move_to(e,t){if(!this.node)return void this.pending_moves.push([e,t]);let n=this;return new Promise((function(i,o){let s=n.rotation_diff[`${n.angle}`];var a=new r.Animation((function(i){n.node.x(e+s.x),n.node.y(t+s.y)}),n.layer);a.start(),setTimeout(i,1e3*n.delay);let l=n.node.position();l.x===e+s.x&&l.y===e+s.y&&a.stop()})).then((e=>console.log("done",n.delay)))}}var c=i.DOMWidgetView.extend({method_changed:function(){let e=JSON.parse(this.model.get("current_call"));a.add((()=>{let t="function"==typeof this[e.method_name]?this[e.method_name].apply(this,e.params):null;console.log("current_call in promise",e);let n=this;return Promise.resolve(t).then((function(t){let i=JSON.stringify({value:t,cb:+new Date,params:e.params,method:e.method_name});return console.log("setting return",i),n.model.set("method_return",i),n.model.save_changes(),i}))}))},render:function(){this._elem=document.createElement("div"),console.log("ðŸš€ ~ file: maze.js ~ line 218 ~ this._elem",this),this._elem.setAttribute("id","container"),this.layer=new r.Layer,this.line_layer=new r.Layer,this.robots=[],this.el.appendChild(this._elem),this.method_changed(),this.listenTo(this.model,"change:current_call",this.method_changed,this)},add_robot:function(e,t,n,i,o,r){return this.robots[e]?Promise.resolve("robot exists"):(this.robots[e]=new h({layer:this.layer,line_layer:this.line_layer,avenue:n,street:i,orientation:o,beepers:r,src:t}),this.robots[e].set_image(t,e).then((e=>{console.log(e)})))},move_to:function(e,t,n){return this.robots[e].move_to(t,n)},add_point:function(e,t,n){let i=this.robots[e];i&&(i.add_point(t,n),i.draw_trace())},remove_trace:function(e){let t=this.robots[e];t.trace_enabled=!1,t.clear_trace()},set_pause:function(e,t){console.log("pause");let n=this.robots[e];return n&&(n.delay=t),Promise.resolve(t)},set_trace:function(e,t,n,i="blue"){let o=this.robots[e];o.enable_trace(),o.traceColor=i,o.add_point(t,n)},init_robot:function(e){let t=this.robots[e];if(t){for(;0!==t.angle;)t.rotate_left();t.clear_trace()}},add_beeper:function(e,t,n,i,o){d(this.layer,e,t,n,i,this.ts,o)},update_beeper:function(e,t,n){this.layer.find(`.beeper-${e}-${t}-text`).text(n),this.layer.draw()},remove_beeper:function(e,t){let n=this.layer.find(`.beeper-${e}-${t}-circle`),i=this.layer.find(`.beeper-${e}-${t}-text`);n&&n.destroy(),i&&i.destroy(),this.layer.draw()},rotate_left:function(e){this.robots[e].rotate_left()},draw_grid:function(e,t,n,i,o,s,a){this.stage=new r.Stage({container:"container",width:e,height:t}),this.stage.add(this.layer),this.stage.add(this.line_layer),this.ts=o;let l=2*o,h=l+2*o*n,c=t-2*o,_=c-2*o*i;!function(e,t,n,i,o,s){for(let a=1;a<t;a++){let t=i+n*(2*a),l=new r.Line({stroke:"gray",points:[t,s,t,o]}),d=new r.Text({text:a,x:t-2,y:o+n-10});e.add(l),e.add(d)}}(this.layer,n,o,l,c,_),function(e,t,n,i,o,s){for(let a=1;a<t;a++){let t=o-n*(2*a),l=new r.Line({stroke:"gray",points:[i,t,s,t]}),d=new r.Text({text:a,y:t-2,x:i-n+5});e.add(l),e.add(d)}}(this.layer,i,o,l,c,h);let u=new r.Line({stroke:"darkred",points:[l,c,h,c,h,_,l,_],strokeWidth:10,closed:!0});return this.layer.add(u),function(e,t,n,i,o){const s=function(e,t){return[n+o*e,i-o*t]};t.map((function([t,n]){let i=[];i=t%2==0?[...s(t,n-1),...s(t,n+1)]:[...s(t-1,n),...s(t+1,n)];let o=new r.Line({stroke:"darkred",strokeWidth:10,closed:!0,points:i});e.add(o)}))}(this.layer,s,l,c,o),function(e,t,n,i,o){t.map((function(t){let r=t.key[0],s=t.key[1];const[a,l]=[n+o*(2*r-1),i-o*(2*s-1)];let h=t.value;d(e,r,s,a,l,o,h)}))}(this.layer,a,l,c,o),this.layer.draw(),Promise.resolve("done")}});e.exports={MazeModel:l,MazeView:c}},1367:(e,t,n)=>{var i=n(7795);e.exports={...i}},306:e=>{"use strict";e.exports={version:"0.2.6"}}}]);