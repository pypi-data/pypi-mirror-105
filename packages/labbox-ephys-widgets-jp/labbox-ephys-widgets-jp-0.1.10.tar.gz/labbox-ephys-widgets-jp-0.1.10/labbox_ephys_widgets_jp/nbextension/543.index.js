(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[543],{46063:e=>{"use strict";function r(e,r){return Object.prototype.hasOwnProperty.call(e,r)}e.exports=function(e,t,s,n){t=t||"&",s=s||"=";var i={};if("string"!=typeof e||0===e.length)return i;var o=/\+/g;e=e.split(t);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var d=0;d<c;++d){var g,u,l,p,f=e[d].replace(o,"%20"),b=f.indexOf(s);b>=0?(g=f.substr(0,b),u=f.substr(b+1)):(g=f,u=""),l=decodeURIComponent(g),p=decodeURIComponent(u),r(i,l)?Array.isArray(i[l])?i[l].push(p):i[l]=[i[l],p]:i[l]=p}return i}},61957:e=>{"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,s,n){return t=t||"&",s=s||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(n){var i=encodeURIComponent(r(n))+s;return Array.isArray(e[n])?e[n].map((function(e){return i+encodeURIComponent(r(e))})).join(t):i+encodeURIComponent(r(e[n]))})).filter(Boolean).join(t):n?encodeURIComponent(r(n))+s+encodeURIComponent(r(e)):""}},85582:(e,r,t)=>{"use strict";r.decode=r.parse=t(46063),r.encode=r.stringify=t(61957)},93543:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v,useWorkspaceRoute:()=>k});var s=t(61416),n=t(69297),i=t.n(n),o=(t(2652),t(97175)),a=t(90066),c=t(61022);const d=function(e){var r=e.children,t=e.theme,n=(0,a.Z)(),d=i().useMemo((function(){var e=null===n?t:function(e,r){return"function"==typeof r?r(e):(0,s.Z)({},e,r)}(n,t);return null!=e&&(e[c.Z]=null!==n),e}),[t,n]);return i().createElement(o.Z.Provider,{value:d},r)};var g=t(5443),u=t(78356),l=t(46470),p=t(6425),f=t(85582);const b=(e,r)=>{const t=e.pathname.split("/"),s=f.parse(e.search.slice(1)).workspace||"default",n=null==r?void 0:r.defaultFeedId,i=s.startsWith("workspace://")?s:n?`workspace://${n}/${s}`:void 0,o=t[1]||"recordings";if(!["recordings","recording","sorting"].includes(o))throw Error(`Invalid page: ${o}`);switch(o){case"recordings":return{workspaceUri:i,page:o};case"recording":return{workspaceUri:i,page:o,recordingId:t[2]};case"sorting":return{workspaceUri:i,page:o,recordingId:t[2]||"",sortingId:t[3]||""};default:return{workspaceUri:i,page:"recordings"}}};var h=e=>{const r=Object.keys(e);return 0===r.length?"":"?"+r.map((r=>encodeURIComponent(r)+"="+encodeURIComponent(e[r]))).join("&")};var m=t(4791),I=t(52978);const O={palette:{primary:{50:"#ede7f6",100:"#d1c4e9",200:"#b39ddb",300:"#9575cd",400:"#7e57c2",500:"#673ab7",600:"#5e35b1",700:"#512da8",800:"#4527a0",900:"#311b92",A100:"#b388ff",A200:"#7c4dff",A400:"#651fff",A700:"#6200ea"},secondary:m.Z},overrides:{MuiAccordionSummary:{root:{"&$expanded":{minHeight:0,maxHeight:30,paddingTop:10},minHeight:0}},MuiToolbar:{regular:{minHeight:48,"@media(min-width:600px)":{minHeight:48}}},MuiTabs:{root:{minHeight:30,maxHeight:30}},MuiTab:{root:{minHeight:30,maxHeight:30,padding:"6px 0px"}}}},U=(0,I.Z)(O);var j=t(8412);const k=(e,r,t)=>{const s=(0,n.useMemo)((()=>s=>{const n=b(r.location,{}),i=(e=>{const r={};switch(e.workspaceUri&&(r.workspace=e.workspaceUri),e.page){case"recordings":return{pathname:"/",search:h(r)};case"recording":return{pathname:`/recording/${e.recordingId}`,search:h(r)};case"sorting":return{pathname:`/sorting/${e.recordingId}/${e.sortingId}`,search:h(r)}}})(((e,r)=>{let t=e;switch(r.type){case"gotoRecordingsPage":t={page:"recordings",workspaceUri:e.workspaceUri};break;case"gotoRecordingPage":t={page:"recording",recordingId:r.recordingId,workspaceUri:e.workspaceUri};break;case"gotoSortingPage":t={page:"sorting",recordingId:r.recordingId,sortingId:r.sortingId,workspaceUri:e.workspaceUri}}return t})(Object.assign(Object.assign({},n),{workspaceUri:t}),s));i.pathname===e.pathname&&i.search===e.search||r.push(i)}),[e,r]);return[(0,n.useMemo)((()=>b(e,{})),[e]),s]},v=({workspaceUri:e,onWorkspaceRouteChanged:r})=>{(0,g._m)();const t=(0,n.useCallback)((e=>{e.forEach((e=>{e.action&&f(e.action)}))}),[]),{feedUri:s}=(0,l.x)(e),{appendMessages:o,loadedInitialMessages:a}=(0,g.Rs)({feedUri:s,subfeedName:"main",onMessages:t}),[c,f]=(0,n.useReducer)(p.Z,{recordings:[],sortings:[]}),b=(0,n.useCallback)((e=>{o([{action:e}])}),[o]),[h,m]=(0,n.useState)(null),[I,O]=(0,n.useState)(void 0),[v,w]=(0,n.useState)(void 0),[y,R]=(0,n.useState)(0),E=i().useCallback((e=>{m(e)}),[]);(0,n.useEffect)((()=>{h&&(I!==h.offsetWidth&&O(h.offsetWidth),v!==h.offsetHeight&&w(h.offsetHeight))}),[h,I,v,O,w,y]),function(e,r){const t=(0,n.useRef)();(0,n.useEffect)((()=>{t.current=e})),(0,n.useEffect)((()=>{{const e=setInterval((function(){void 0!==(null==t?void 0:t.current)&&(null==t||t.current())}),r);return()=>clearInterval(e)}}),[r])}((()=>{R(y+1)}),1e3);const[_,S]=(0,n.useState)({pathname:"",search:"?"}),[C,T]=(0,n.useState)([]),M=(0,n.useMemo)((()=>({location:_,push:e=>{T([...C,_]),S(e)}})),[_,C]),[x,N]=k(_,M,e);return(0,n.useEffect)((()=>{r&&r(x)}),[x,r]),i().createElement(d,{theme:U},i().createElement("div",{ref:E,className:"WorkspaceViewWrapper",style:{position:"absolute",left:0,right:0,top:0,bottom:0}},i().createElement(u.Z,{workspace:c,workspaceDispatch:b,workspaceRoute:x,workspaceRouteDispatch:N,version:j.Z,width:I||700,height:v||700})))}},46470:(e,r,t)=>{"use strict";t.d(r,{x:()=>s});const s=e=>{if(!e)return{feedUri:void 0,feedId:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,feedId:void 0};const r=e.split("?")[0].split("/")[2]||void 0;return r?{feedId:r,feedUri:`feed://${r}`}:{feedUri:void 0,feedId:void 0}}},6425:(e,r,t)=>{"use strict";t.d(r,{j:()=>s,Z:()=>a});const s=(e,r)=>{if("SET_CURATION"===r.type)return r.curation;if("ADD_UNIT_LABEL"===r.type){const t=r.unitId+"",s=(e.labelsByUnit||{})[t]||[];return s.includes(r.label)?e:Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[t]:[...s,r.label].sort()})})}if("REMOVE_UNIT_LABEL"===r.type){const t=r.unitId+"",s=(e.labelsByUnit||{})[t]||[];return s.includes(r.label)?Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[t]:s.filter((e=>e!==r.label))})}):e}return"MERGE_UNITS"===r.type?Object.assign(Object.assign({},e),{mergeGroups:o([...e.mergeGroups||[],r.unitIds])}):"UNMERGE_UNITS"===r.type?Object.assign(Object.assign({},e),{mergeGroups:o((e.mergeGroups||[]).map((e=>e.filter((e=>!r.unitIds.includes(e))))))}):e},n=(e,r)=>e.filter((e=>r.includes(e))),i=(e,r)=>[...e,...r.filter((r=>!e.includes(r)))].sort(),o=e=>{const r=e.map((e=>[...e]));let t=!0;for(;t;){t=!1;for(let e=0;e<r.length;e++){const s=r[e];for(let o=e+1;o<r.length;o++){const a=r[o];n(s,a).length>0&&(r[e]=i(s,a),r[o]=[],t=!0)}}}return r.filter((e=>e.length>=2))},a=(e,r)=>{switch(r.type){case"ADD_RECORDING":return Object.assign(Object.assign({},e),{recordings:[...e.recordings.filter((e=>e.recordingId!==r.recording.recordingId)),r.recording]});case"DELETE_RECORDINGS":return Object.assign(Object.assign({},e),{recordings:e.recordings.filter((e=>!r.recordingIds.includes(e.recordingId)))});case"ADD_SORTING":return Object.assign(Object.assign({},e),{sortings:[...e.sortings.filter((e=>e.sortingId!==r.sorting.sortingId)),r.sorting]});case"DELETE_SORTINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!r.sortingIds.includes(e.sortingId)))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!r.recordingIds.includes(e.recordingId)))});case"SET_UNIT_METRICS_FOR_SORTING":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===r.unitMetricsForSorting.sortingId?Object.assign(Object.assign({},e),{unitMetricsUri:r.unitMetricsForSorting.metricsUri}):e))});default:return e}}}}]);