(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[923],{4923:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>I,useWorkspaceRoute:()=>b});var t=s(22954),a=s(5443),o=s(69297),i=s.n(o),c=s(95849),n=s(46470),d=s(6425),p=s(85582);const g=(e,r)=>{const s=e.pathname.split("/"),t=p.parse(e.search.slice(1)).workspace||"default",a=null==r?void 0:r.defaultFeedId,o=t.startsWith("workspace://")?t:a?`workspace://${a}/${t}`:void 0,i=s[1]||"recordings";if(!["recordings","recording","sorting"].includes(i))throw Error(`Invalid page: ${i}`);switch(i){case"recordings":return{workspaceUri:o,page:i};case"recording":return{workspaceUri:o,page:i,recordingId:s[2]};case"sorting":return{workspaceUri:o,page:i,recordingId:s[2]||"",sortingId:s[3]||""};default:return{workspaceUri:o,page:"recordings"}}};var u=e=>{const r=Object.keys(e);return 0===r.length?"":"?"+r.map((r=>encodeURIComponent(r)+"="+encodeURIComponent(e[r]))).join("&")},h=s(40788),l=s(4791),m=s(52978);const k={palette:{primary:h.Z,secondary:l.Z},overrides:{MuiAccordionSummary:{root:{"&$expanded":{minHeight:0,maxHeight:30,paddingTop:10},minHeight:0}},MuiToolbar:{regular:{minHeight:48,"@media(min-width:600px)":{minHeight:48}}},MuiTabs:{root:{minHeight:30,maxHeight:30}},MuiTab:{root:{minHeight:30,maxHeight:30,padding:"6px 0px"}}}},w=(0,m.Z)(k);var f=s(19973);const b=(e,r,s)=>{const t=(0,o.useMemo)((()=>t=>{const a=g(r.location,{}),o=(e=>{const r={};switch(e.workspaceUri&&(r.workspace=e.workspaceUri),e.page){case"recordings":return{pathname:"/",search:u(r)};case"recording":return{pathname:`/recording/${e.recordingId}`,search:u(r)};case"sorting":return{pathname:`/sorting/${e.recordingId}/${e.sortingId}`,search:u(r)}}})(((e,r)=>{let s=e;switch(r.type){case"gotoRecordingsPage":s={page:"recordings",workspaceUri:e.workspaceUri};break;case"gotoRecordingPage":s={page:"recording",recordingId:r.recordingId,workspaceUri:e.workspaceUri};break;case"gotoSortingPage":s={page:"sorting",recordingId:r.recordingId,sortingId:r.sortingId,workspaceUri:e.workspaceUri}}return s})(Object.assign(Object.assign({},a),{workspaceUri:s}),t));o.pathname===e.pathname&&o.search===e.search||r.push(o)}),[e,r]);return[(0,o.useMemo)((()=>g(e,{})),[e]),t]},I=({workspaceUri:e,onWorkspaceRouteChanged:r})=>{const s=(0,a._m)(),p=(0,o.useCallback)((e=>{e.forEach((e=>{e.action&&I(e.action)}))}),[]),{feedUri:g,workspaceName:u}=(0,n.x)(e),h=(0,o.useMemo)((()=>({workspaceName:u||""})),[u]),{appendMessages:l,loadedInitialMessages:m}=(0,a.Rs)({feedUri:g,subfeedName:h,onMessages:p}),[k,I]=(0,o.useReducer)(d.Z,{recordings:[],sortings:[]}),U=(0,o.useCallback)((e=>{l([{action:e}])}),[l]),[v,H]=(0,o.useState)(null),[M,R]=(0,o.useState)(void 0),[x,E]=(0,o.useState)(void 0),[y,C]=(0,o.useState)(0),S=i().useCallback((e=>{H(e)}),[]);(0,o.useEffect)((()=>{v&&(M!==v.offsetWidth&&R(v.offsetWidth),x!==v.offsetHeight&&E(v.offsetHeight))}),[v,M,x,R,E,y]),function(e,r){const s=(0,o.useRef)();(0,o.useEffect)((()=>{s.current=e})),(0,o.useEffect)((()=>{{const e=setInterval((function(){void 0!==(null==s?void 0:s.current)&&(null==s||s.current())}),r);return()=>clearInterval(e)}}),[r])}((()=>{C(y+1)}),1e3);const[j,W]=(0,o.useState)({pathname:"",search:"?"}),[$,_]=(0,o.useState)([]),Z=(0,o.useMemo)((()=>({location:j,push:e=>{_([...$,j]),W(e)}})),[j,$]),[N,O]=b(j,Z,e);return(0,o.useEffect)((()=>{r&&r(N)}),[N,r]),i().createElement(t.Z,{theme:w},i().createElement("div",{ref:S,className:"WorkspaceViewWrapper",style:{position:"absolute",left:0,right:0,top:0,bottom:0}},i().createElement(f.Z,Object.assign({},{defaultFeedId:"",workspace:k,workspaceDispatch:U,plugins:(0,c.qG)(s),workspaceRoute:N,workspaceRouteDispatch:O,width:M||700,height:x||700}))))}}}]);