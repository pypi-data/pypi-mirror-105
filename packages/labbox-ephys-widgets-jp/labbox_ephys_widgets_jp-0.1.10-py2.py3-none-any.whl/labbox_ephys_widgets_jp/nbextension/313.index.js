(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[313],{99233:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var l=n(60352),i=n.n(l)()((function(e){return e[1]}));i.push([e.id,".TableWidget .MuiTableCell-root {\n    padding-top: 1px;\n    padding-bottom: 1px;\n    padding-left: 0px;\n    padding-right: 0px;\n    font-size: 12px;\n    border: solid 1px #f0f0f0;\n}\n\n.TableWidget .MuiTableCell-root.selectedRow {\n    background-color: #b5d1ff;\n}",""]);const s=i},10051:(e,t,n)=>{"use strict";n.d(t,{D:()=>s,h:()=>r});var l=n(5443),i=n(69297);const s=(e,t)=>{const{result:n}=(0,l.lG)(e?"createjob_get_sorting_info":"",{sorting_object:e,recording_object:t},{useClientCache:!0});return n},r=e=>{const t=(0,i.useContext)(l.Zo),n=(0,i.useRef)({}),[,s]=(0,i.useState)(0),r={};return e.forEach((e=>{const l=e.sortingId;if(!n.current[l]){const i=t.createHitherJob("createjob_get_sorting_info",{recording_object:e.recordingObject,sorting_object:e.sortingObject},{useClientCache:!0});n.current[l]=i,i.wait().then((()=>{s((e=>e+1))})).catch((()=>{s((e=>e+1))}))}n.current[l].result&&(r[l]=n.current[l].result)})),r}},95849:(e,t,n)=>{"use strict";n.d(t,{kN:()=>a,GI:()=>d,CC:()=>o,Zl:()=>r,_S:()=>b,SF:()=>u,fG:()=>y,fB:()=>f,Sd:()=>g,FO:()=>I});var l=n(5443),i=n(69297);const s=(e,t)=>{if(e.min<=t&&t<e.max)return e;const n=e.max-e.min,l=Math.max(0,Math.floor(t-n/2));return{min:l,max:l+n}},r=(e,t)=>{var n,l,i,r;if("SetRecordingSelection"===t.type)return Object.assign({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{selectedElectrodeIds:t.selectedElectrodeIds.filter((t=>!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)))});if("SetVisibleElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((e=>t.visibleElectrodeIds.includes(e))):void 0});if("SetCurrentTimepoint"===t.type)return Object.assign(Object.assign({},e),{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?s(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object.assign(Object.assign({},e),{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){const i=9e6,s=e.currentTimepoint,r=e.timeRange;if(!r)return e;const o=null!==(n=t.direction)&&void 0!==n?n:"in",a=null!==(l=t.factor)&&void 0!==l?l:1.4,d="out"===o?1/a:a;if((r.max-r.min)/d>i)return e;let u;u=void 0===s||s<r.min?r.min:s>r.max?r.max:s;const m=c(r,d,u);return Object.assign(Object.assign({},e),{timeRange:m})}if("SetAmpScaleFactor"===t.type)return Object.assign(Object.assign({},e),{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){const n=null!==(i=t.direction)&&void 0!==i?i:"up",l=null!==(r=t.multiplier)&&void 0!==r?r:1.4,s="down"===n?1/l:l;return Object.assign(Object.assign({},e),{ampScaleFactor:(e.ampScaleFactor||1)*s})}return"SetCurrentTimepointVelocity"===t.type?Object.assign(Object.assign({},e),{animation:Object.assign(Object.assign({},e.animation||{}),{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object.assign(Object.assign({},e),{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},c=(e,t,n)=>{const l=n+(e.min-n)/t,i=n+(e.max-n)/t;return{min:Math.floor(l),max:Math.floor(i)}},o=(e,t)=>((t||{}).mergeGroups||[]).filter((t=>t.includes(e)))[0]||null,a=(e,t,n)=>n&&o(e,t)||e,d=(e,t)=>{const n=o(e,t);return!n||Math.min(...n)===e},u=(e,t)=>"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:t.selectedUnitIds.filter((t=>{var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>{var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?((e,t)=>{const n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object.assign(Object.assign({},e),{selectedUnitIds:(e.selectedUnitIds||[]).filter((e=>e!==n))}):Object.assign(Object.assign({},e),{selectedUnitIds:[...e.selectedUnitIds||[],n]}):Object.assign(Object.assign({},e),{selectedUnitIds:[n]})})(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?m(Object.assign(Object.assign({},e),{applyMerges:!e.applyMerges}),t.curation):r(e,t),m=(e,t)=>e.applyMerges&&t?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>d(e,t))):void 0}):e,p=e=>e.filter((e=>!e.disabled&&!e.development)),g=e=>p(e).filter((e=>"SortingView"===e.type)).map((e=>e)),b=e=>p(e).filter((e=>"RecordingView"===e.type)).map((e=>e)),f=e=>p(e).filter((e=>"SortingUnitView"===e.type)).map((e=>e)),y=e=>p(e).filter((e=>"SortingUnitMetric"===e.type)).map((e=>e)),I=()=>{const e=(0,l._m)();return(0,i.useMemo)((()=>e.filter((e=>"WorkspaceView"===e.type)).map((e=>e))),[e])}},54514:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const l=e=>(e=>Array.isArray(e))(e)?e.sort(((e,t)=>e.priority===t.priority?(e.label||"")<(t.label||"")?-1:(e.label||"")>(t.label||"")?1:0:(t.priority||0)-(e.priority||0))):l(Object.values(e)),i=l},3940:(e,t,n)=>{"use strict";n.d(t,{Z:()=>k});var l=n(5443),i=n(69297),s=n.n(i),r=n(95849),c=n(54514),o=n(93379),a=n.n(o),d=n(99233);a()(d.Z,{insert:"head",singleton:!1}),d.Z.locals;var u=n(43640),m=n(4606),p=n(37450),g=n(2197),b=n(92378),f=n(81459),y=n(91969),I=n(12930),h=n(62961),E=n(22682),v=n(62198);const j=e=>{const{columns:t,onColumnClick:n,primarySortColumnDirection:l,primarySortColumnName:i,onDeselectAll:r}=e;return s().createElement(p.Z,null,s().createElement(g.Z,null,r?s().createElement(b.Z,{key:"_checkbox"},s().createElement(S,{rowId:"",selected:!1,onClick:()=>{r()},isDeselectAll:!0})):s().createElement(b.Z,{key:"_checkbox"}),t.map((e=>{const t=(e.tooltip||e.label||"")+" (click to sort)";return s().createElement(b.Z,{key:e.columnName,onClick:()=>n(e),title:t,style:{cursor:"pointer"}},s().createElement(f.Z,{container:!0,justify:"flex-start",style:{flexFlow:"row"}},s().createElement(f.Z,{item:!0,key:"icon"},s().createElement("span",{style:{fontSize:16,color:"gray",paddingLeft:3,paddingRight:5,paddingTop:2}},i===e.columnName&&("ascending"===l?s().createElement(m.G,{icon:u.l1h}):s().createElement(m.G,{icon:u.eW2})))),s().createElement(f.Z,{item:!0,key:"text"},s().createElement("span",null,s().createElement("span",{key:"label"},e.label),s().createElement("span",{key:"progress"},e.calculating&&s().createElement(y.Z,null))))))}))))},S=s().memo((e=>{const{rowId:t,selected:n,onClick:l,isDeselectAll:i}=e;return s().createElement(I.Z,{checked:n,indeterminate:!!i,onClick:()=>l(t),style:{padding:1},title:i?"Deselect all":`Select ${t}`})})),O=e=>{const{selectedRowIds:t,onSelectedRowIdsChanged:n,rows:l,columns:r,defaultSortColumnName:c,height:o}=e,[a,d]=(0,i.useState)([]);(0,i.useEffect)((()=>{0===a.length&&c&&d([c])}),[d,a,c]);const u=(0,i.useCallback)((e=>{const l=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(l)}),[t,n]),m=[...l],p=e=>r.filter((t=>t.columnName===e))[0],f=(e=>{const t=[];for(let n=0;n<e.length;n++){const l=e[n-1]!==e[n];t.push({columnName:e[n],keyOrder:n,sortAscending:l})}return t})(a);for(const e of f){const t=e.columnName,n=p(t);m.sort(((l,i)=>{const s=l.data[t]||{},r=i.data[t]||{},c=s.sortValue,o=r.sortValue;return e.sortAscending?n.sort(c,o):n.sort(o,c)}))}const y=(t||[]).reduce(((e,t)=>(e[t]=!0,e)),{}),I=f.length>0?f[f.length-1]:void 0,O=I?I.columnName:void 0,k=I?I.sortAscending?"ascending":"descending":void 0;return s().createElement(h.Z,{style:void 0!==o?{maxHeight:o}:{}},s().createElement(E.Z,{stickyHeader:!0,className:"TableWidget"},s().createElement(j,{columns:r,primarySortColumnName:O,primarySortColumnDirection:k,onColumnClick:e=>{const t=e.columnName;let n=[...a];n=a[a.length-1]===t?a[a.length-2]===t?n.slice(0,n.length-1):[...n,t]:[...n.filter((e=>e!==t)),t],d(n)},onDeselectAll:t.length>0?()=>{n([])}:void 0}),s().createElement(v.Z,null,m.map((e=>{const t=y[e.rowId]||!1;return s().createElement(g.Z,{key:e.rowId},s().createElement(b.Z,{key:"_checkbox",className:t?"selectedRow":""},s().createElement(S,{rowId:e.rowId,selected:t,onClick:()=>u(e.rowId)})),r.map((n=>s().createElement(b.Z,{key:n.columnName,className:t?"selectedRow":""},s().createElement("div",{title:n.tooltip},n.dataElement(e.data[n.columnName].value))))))})))))},k=e=>{const{sortingUnitMetrics:t,units:n,metrics:o,selection:a,selectionDispatch:d,curation:u,sorting:m,height:p}=e,g=(a||{}).selectedUnitIds||[],b=(0,c.Z)(Object.values(t||{})).filter((e=>!e.disabled)),f=(0,i.useCallback)((e=>{d({type:"SetSelectedUnitIds",selectedUnitIds:e.map((e=>Number(e)))})}),[d]),y=n.map((e=>({rowId:e+"",data:{}}))),I=(e,t)=>Number(e)-Number(t),h=e=>s().createElement("span",null,e+""),E={color:"black",fontWeight:"bold",cursor:"pointer"},v={color:"gray",textDecoration:"underline",cursor:"pointer"},j=[];j.push({columnName:"_unit_id",label:"Unit ID",tooltip:"Unit ID",sort:I,dataElement:e=>{const{unitId:t,mergeGroup:n}=e;return s().createElement("span",null,s().createElement("span",{key:"unitId",style:E},t+""),n&&n.length>0&&s().createElement("span",{key:"mergeGroup"},` (${n.map((e=>e+"")).join(", ")})`))}}),y.forEach((e=>{const t=Number(e.rowId);e.data._unit_id={value:{unitId:t,mergeGroup:(0,r.CC)(t,u)},sortValue:t}})),j.push({columnName:"_labels",label:"Labels",tooltip:"Curation labels",sort:(e,t)=>e<t?-1:e>t?1:0,dataElement:e=>{const t=e;return s().createElement("span",null,t.map((e=>s().createElement("span",{key:e},s().createElement("span",{style:v},e),"Â "))))}}),y.forEach((e=>{const t=((e,t)=>((t||{}).labelsByUnit||{})[e]||[])(Number(e.rowId),u);e.data._labels={value:t,sortValue:t.join(", ")}}));const{result:S,job:k}=(0,l.lG)("createjob_fetch_unit_metrics",{unit_metrics_uri:m.unitMetricsUri||""},{useClientCache:!0});(S||[]).forEach((e=>{const t="external-metric-"+e.name;j.push({columnName:t,label:e.label,tooltip:e.tooltip||"",sort:I,dataElement:h}),y.forEach((n=>{const l=Number(n.rowId),i=e.data[l+""];n.data[t]={value:void 0!==i?i:NaN,sortValue:void 0!==i?i:NaN}}))})),b.forEach((e=>{const t="plugin-metric-"+e.name,n=(o||{})[e.name]||null,l=n?n.data:null;j.push({columnName:t,label:e.columnLabel,tooltip:e.tooltip||"",sort:I,dataElement:e.component,calculating:n&&!l}),y.forEach((n=>{const i=Number(n.rowId),s=l&&i+""in l?l[i+""]:void 0,r=void 0!==s?e.getValue(s):void 0;n.data[t]={value:s,sortValue:void 0!==r?r:e.isNumeric?NaN:""}}))}));const C=g.map((e=>e+""));return s().createElement(O,{rows:y,columns:j,selectedRowIds:C,onSelectedRowIdsChanged:f,defaultSortColumnName:"_unit_id",height:p})}}}]);