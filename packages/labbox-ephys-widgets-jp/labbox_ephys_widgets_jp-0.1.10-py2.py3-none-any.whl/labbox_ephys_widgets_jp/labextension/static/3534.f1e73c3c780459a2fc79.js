(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[3534],{65940:(e,t,n)=>{"use strict";n.d(t,{N:()=>g});var r=n(16213),o=n(17872),i=n(62341);const a={electrodeBoxes:[],radius:0,pixelRadius:0,dragRegion:null,draggedElectrodeIds:[],hoveredElectrodeId:null},l={border:"rgb(30, 30, 30)",base:"rgb(0, 0, 255)",selected:"rgb(196, 196, 128)",hover:"rgb(128, 128, 255)",selectedHover:"rgb(200, 200, 196)",dragged:"rgb(0, 0, 196)",draggedSelected:"rgb(180, 180, 150)",dragRect:"rgba(196, 196, 196, 0.5)",textLight:"rgb(228, 228, 228)",textDark:"rgb(32, 32, 32)"},s=(e,t)=>{if(e.type!==r.II.Release)return;const{selectionDispatch:n,electrodeOpts:i}=t.getProps();if(i.disableSelection)return;const a=t.getState();if(null===a)return;const l=a.electrodeBoxes.filter((t=>(0,o.Xz)(e.point,[t.x,t.y],a.radius))).map((e=>e.id));if(0===l.length)return void(e.modifiers.ctrl||e.modifiers.shift||a.dragRegion||n({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[]}));const s=l[0],c=t.getProps().selection.selectedElectrodeIds||[];n({type:"SetSelectedElectrodeIds",selectedElectrodeIds:e.modifiers.ctrl?c.includes(s)?c.filter((e=>e!==s)):[...c,s]:e.modifiers.shift?[...c,s]:[s]}),t.scheduleRepaint()},c=(e,t)=>{if(e.type!==r.II.Move)return;const n=t.getState();if(null===n)return;const i=n.electrodeBoxes.filter((t=>(0,o.Xz)(e.point,[t.x,t.y],n.radius))).map((e=>e.id));t.setState(Object.assign(Object.assign({},n),{hoveredElectrodeId:0===i.length?null:i[0]})),t.scheduleRepaint()},d=(e,t)=>{var n,r,i;const a=e.getState(),{selectionDispatch:l,electrodeOpts:s}=e.getProps();if(s.disableSelection)return;if(null===a)return;const c=null!==(n=a.electrodeBoxes.filter((e=>(0,o.Qv)(e.rect,t.dragRect))))&&void 0!==n?n:[];t.released?(l({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[...t.shift&&null!==(i=null===(r=e.getProps())||void 0===r?void 0:r.selection.selectedElectrodeIds)&&void 0!==i?i:[],...c.map((e=>e.id))]}),e.setState(Object.assign(Object.assign({},a),{dragRegion:null,draggedElectrodeIds:[]}))):e.setState(Object.assign(Object.assign({},a),{dragRegion:t.dragRect,draggedElectrodeIds:c.map((e=>e.id))})),e.scheduleRepaint()},g=()=>new r.Fw(((e,t,n)=>{var r,o;const i=t.electrodeOpts,a=i.colors||l,s=i.showLabels;e.wipe();const c=n.pixelRadius>5;for(let l of n.electrodeBoxes){const d=!i.disableSelection&&((null===(r=t.selection.selectedElectrodeIds)||void 0===r?void 0:r.includes(l.id))||!1),g=!i.disableSelection&&n.hoveredElectrodeId===l.id,u=!i.disableSelection&&((null===(o=n.draggedElectrodeIds)||void 0===o?void 0:o.includes(l.id))||!1),m=d?u?a.draggedSelected:a.selectedHover:u?a.dragged:g?a.hover:a.base,p=t.layoutMode;if("geom"===p?(e.fillEllipse(l.rect,{color:m}),e.drawEllipse(l.rect,{color:a.border})):"vertical"===p&&e.drawLine(l.rect.xmin,(l.rect.ymin+l.rect.ymax)/2,l.rect.xmax,(l.rect.ymin+l.rect.ymax)/2,{color:a.border}),c){const t=[a.selected,a.draggedSelected,a.hover,a.selectedHover].includes(m)?a.textDark:a.textLight;s&&e.drawText({rect:l.rect,alignment:{Horizontal:"AlignCenter",Vertical:"AlignCenter"},font:{pixelSize:n.pixelRadius,family:"Arial"},pen:{color:t},brush:{color:t},text:l.label})}}n.dragRegion&&e.fillRect(n.dragRegion,{color:a.dragRect})}),((e,t)=>{const n=e.getState(),{width:r,height:o,electrodeLocations:a,electrodeIds:l,layoutMode:s}=t,{electrodeBoxes:c,transform:d,radius:g,pixelRadius:u}=(0,i.Z)({width:r,height:o,electrodeLocations:a,electrodeIds:l,layoutMode:s,maxElectrodePixelRadius:t.electrodeOpts.maxElectrodePixelRadius});e.setTransformMatrix(d),e.setState(Object.assign(Object.assign({},n),{electrodeBoxes:c,radius:g,pixelRadius:u})),e.scheduleRepaint()}),a,{discreteMouseEventHandlers:[s,c],dragHandlers:[d]})},62341:(e,t,n)=>{"use strict";n.d(t,{g:()=>d,Z:()=>g});var r=n(7916),o=n(45157),i=n(17872),a=n(22874);const l=new Map,s=e=>{const t=JSON.stringify(e),n=l.get(t);if(void 0!==n)return n;let o=Number.MAX_VALUE;e.forEach((t=>{e.forEach((e=>{const n=(0,r.norm)([t[0]-e[0],t[1]-e[1]]);0!==n&&(o=Math.min(o,n))}))}));const i=.45*o;return l.set(t,i),i},c=(e,t)=>({xmin:(0,a.Gt)(e.map((e=>e[0])))-t,xmax:(0,a.lR)(e.map((e=>e[0])))+t,ymin:(0,a.Gt)(e.map((e=>e[1])))-t,ymax:(0,a.lR)(e.map((e=>e[1])))+t}),d=e=>{const t=s(e),n=c(e,t);return(0,i.dz)(n)/(0,i.Cr)(n)},g=e=>{const{width:t,height:n,electrodeLocations:r,electrodeIds:l,layoutMode:d}=e;if("vertical"===d)return(({width:e,height:t,electrodeIds:n})=>{const r=n.length,i=(0,o.As)((n=>[10+n[0]*(e-20),10+n[1]*(t-20)]));return{electrodeBoxes:n.map(((e,t)=>{const n=(.5+t)/(r+1),i={xmin:0,xmax:1,ymin:n-.5/(r+1),ymax:n+.5/(r+1)},a=(0,o.As)((e=>[i.xmin+e[0]*(i.xmax-i.xmin),i.ymin+e[1]*(i.ymax-i.ymin)]));return{label:e+"",id:e,x:.5,y:n,rect:i,transform:a}})),transform:i,radius:1/(r+1),pixelRadius:(t-20)/(r+1)}})({width:t,height:n,electrodeIds:l});const g=(e=>{const t=(0,a.Gt)(e.map((e=>e[0]))),n=(0,a.lR)(e.map((e=>e[0]))),r=(0,a.Gt)(e.map((e=>e[1]))),o=(0,a.lR)(e.map((e=>e[1])));return t===n&&r===o?e.map(((e,t)=>[t,0])):e})(r),u=t-20,m=n-20,p=u/m,b=s(g);let h,f=c(g,b),E=(0,i.dz)(f)/(0,i.Cr)(f),_=g;E>1!=p>1&&(_=g.map((e=>[e[1],-e[0]])),f={xmin:f.ymin,xmax:f.ymax,ymin:-f.xmax,ymax:-f.xmin},E=(0,i.dz)(f)/(0,i.Cr)(f)),h=E>p?u/(0,i.dz)(f):m/(0,i.Cr)(f),e.maxElectrodePixelRadius&&b*h>e.maxElectrodePixelRadius&&(h/=b*h/e.maxElectrodePixelRadius);const k=(t-(0,i.dz)(f)*h)/2,y=(n-(0,i.Cr)(f)*h)/2,w=(0,o.As)((e=>[k+(e[0]-f.xmin)*h,y+(e[1]-f.ymin)*h])),x=_.map(((e,t)=>{const n=e[0],r=e[1],a=(0,i.jU)([n,r],b,b),s=(0,o.As)((e=>[a.xmin+e[0]*(a.xmax-a.xmin),a.ymin+e[1]*(a.ymax-a.ymin)]));return{label:l[t]+"",id:l[t],x:n,y:r,rect:a,transform:s}})),R=(0,i.ur)(w,[b,0])[0];return{electrodeBoxes:x,transform:w,radius:b,pixelRadius:R}}},78048:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(47033),o=n(56271),i=n.n(o);const a=e=>i().createElement(r.Accordion,{TransitionProps:{unmountOnExit:void 0===e.unmountOnExit||e.unmountOnExit},defaultExpanded:e.defaultExpanded},i().createElement(r.AccordionSummary,null,e.icon&&i().createElement("span",{style:{paddingRight:10}},e.icon),i().createElement("span",{style:{paddingTop:3}},e.label)),i().createElement(r.AccordionDetails,null,i().createElement("div",{style:{width:"100%"}},e.children)))},31222:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(56271),o=n.n(r);const i=e=>o().createElement("span",{style:{color:"gray",cursor:"pointer",textDecoration:"underline"},onClick:e.onClick},e.children)},96768:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d}),n(39428);var r=n(56271),o=n.n(r),i=n(31675),a=n.n(i),l=n(45679);const s={'code[class*="language-"]':{color:"black",background:"none",fontFamily:"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace",fontSize:"1em",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",lineHeight:"1.5",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",maxHeight:"inherit",height:"inherit",padding:"0 1em",display:"block",overflow:"auto"},'pre[class*="language-"]':{color:"black",background:"none",fontFamily:"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace",fontSize:"1em",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",lineHeight:"1.5",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",position:"relative",margin:".5em 0",overflow:"visible",padding:"0",backgroundColor:"#fdfdfd",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box",boxSizing:"border-box",marginBottom:"1em"},'pre[class*="language-"]>code':{position:"relative",borderLeft:"10px solid #358ccb",boxShadow:"-1px 0px 0px 0px #358ccb, 0px 0px 0px 1px #dfdfdf",backgroundColor:"#fdfdfd",backgroundImage:"linear-gradient(transparent 50%, rgba(69, 142, 209, 0.04) 50%)",backgroundSize:"3em 3em",backgroundOrigin:"content-box",backgroundAttachment:"local"},':not(pre) > code[class*="language-"]':{backgroundColor:"#fdfdfd",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box",boxSizing:"border-box",marginBottom:"1em",position:"relative",padding:".2em",borderRadius:"0.3em",color:"#c92c2c",border:"1px solid rgba(0, 0, 0, 0.1)",display:"inline",whiteSpace:"normal"},'pre[class*="language-"]:before':{content:"''",zIndex:"-2",display:"block",position:"absolute",bottom:"0.75em",left:"0.18em",width:"40%",height:"20%",maxHeight:"13em",boxShadow:"0px 13px 8px #979797",WebkitTransform:"rotate(-2deg)",MozTransform:"rotate(-2deg)",msTransform:"rotate(-2deg)",OTransform:"rotate(-2deg)",transform:"rotate(-2deg)"},'pre[class*="language-"]:after':{content:"''",zIndex:"-2",display:"block",position:"absolute",bottom:"0.75em",left:"auto",width:"40%",height:"20%",maxHeight:"13em",boxShadow:"0px 13px 8px #979797",WebkitTransform:"rotate(2deg)",MozTransform:"rotate(2deg)",msTransform:"rotate(2deg)",OTransform:"rotate(2deg)",transform:"rotate(2deg)",right:"0.75em"},comment:{color:"#7D8B99"},"block-comment":{color:"#7D8B99"},prolog:{color:"#7D8B99"},doctype:{color:"#7D8B99"},cdata:{color:"#7D8B99"},punctuation:{color:"#5F6364"},property:{color:"#c92c2c"},tag:{color:"#c92c2c"},boolean:{color:"#c92c2c"},number:{color:"#c92c2c"},"function-name":{color:"#c92c2c"},constant:{color:"#c92c2c"},symbol:{color:"#c92c2c"},deleted:{color:"#c92c2c"},selector:{color:"#2f9c0a"},"attr-name":{color:"#2f9c0a"},string:{color:"#2f9c0a"},char:{color:"#2f9c0a"},function:{color:"#2f9c0a"},builtin:{color:"#2f9c0a"},inserted:{color:"#2f9c0a"},operator:{color:"#a67f59",background:"rgba(255, 255, 255, 0.5)"},entity:{color:"#a67f59",background:"rgba(255, 255, 255, 0.5)",cursor:"help"},url:{color:"#a67f59",background:"rgba(255, 255, 255, 0.5)"},variable:{color:"#a67f59",background:"rgba(255, 255, 255, 0.5)"},atrule:{color:"#1990b8"},"attr-value":{color:"#1990b8"},keyword:{color:"#1990b8"},"class-name":{color:"#1990b8"},regex:{color:"#e90"},important:{color:"#e90",fontWeight:"normal"},".language-css .token.string":{color:"#a67f59",background:"rgba(255, 255, 255, 0.5)"},".style .token.string":{color:"#a67f59",background:"rgba(255, 255, 255, 0.5)"},bold:{fontWeight:"bold"},italic:{fontStyle:"italic"},namespace:{Opacity:".7"},'pre[class*="language-"].line-numbers.line-numbers':{paddingLeft:"0"},'pre[class*="language-"].line-numbers.line-numbers code':{paddingLeft:"3.8em"},'pre[class*="language-"].line-numbers.line-numbers .line-numbers-rows':{left:"0"},'pre[class*="language-"][data-line]':{paddingTop:"0",paddingBottom:"0",paddingLeft:"0"},"pre[data-line] code":{position:"relative",paddingLeft:"4em"},"pre .line-highlight":{marginTop:"0"}},c=({value:e,language:t})=>o().createElement(l.Prism,{language:t,style:s},e),d=({source:e,substitute:t})=>{const n=t?((e,t)=>{let n=e;for(let e in t)n=n.split(`{${e}}`).join(t[e]||"");return n})(e,t):e;return o().createElement("div",{className:"markdown-body"},o().createElement(a(),{source:n,renderers:{code:c}}))}},88493:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(56271),o=n.n(r),i=n(13090),a=n.n(i);const l=e=>{var t,n,i;const{width:l,height:s,initialPosition:c,onChange:d,adjustable:g=!0,positionFromRight:u=!1}=e,[m,p]=(0,r.useState)(c);if(!e.children)throw Error("Unexpected: no props.children");let b,h;if(Array.isArray(e.children)){const t=e.children.filter((e=>void 0!==e));b=t[0],h=t[1]||null}else b=e.children,h=null;if(!h)return o().createElement(b.type,Object.assign({},b.props,{width:l,height:s}));const f=u?l-m:m,E=g?null!==(t=e.gripThickness)&&void 0!==t?t:10:0,_=g?null!==(n=e.gripInnerThickness)&&void 0!==n?n:4:0,k=g?null!==(i=e.gripMargin)&&void 0!==i?i:2:0,y=f-E/2-k,w=l-y-E-2*k;let x={top:0,left:0,width:l,height:s},R={left:0,top:0,width:y,height:s,zIndex:0,overflowY:"auto",overflowX:"hidden"},I={left:y+E+2*k,top:0,width:w,height:s,zIndex:0,overflowY:"auto",overflowX:"hidden"},S={left:0,top:0,width:E+2*k,height:s,backgroundColor:"transparent",cursor:"col-resize",zIndex:9998},v={left:k,top:0,width:E,height:s,background:"rgb(230, 230, 230)",cursor:"col-resize"},C={top:0,left:(E-_)/2,width:_,height:s,background:"gray",cursor:"col-resize"};return o().createElement("div",{className:"splitter",style:Object.assign(Object.assign({},x),{position:"relative"})},o().createElement("div",{key:"child1",style:Object.assign(Object.assign({},R),{position:"absolute"}),className:"SplitterChild"},o().createElement(b.type,Object.assign({},b.props,{width:y,height:s}))),g&&o().createElement(a(),{key:"drag",position:{x:f-E/2-k,y:0},axis:"x",onDrag:(e,t)=>{},onStop:(e,t)=>((e,t)=>{const n=t.x;if(n===f)return;const r=u?l-n:n;p(r),d&&d(r)})(0,t)},o().createElement("div",{style:Object.assign(Object.assign({},S),{position:"absolute"})},o().createElement("div",{style:Object.assign(Object.assign({},v),{position:"absolute"})},o().createElement("div",{style:Object.assign(Object.assign({},C),{position:"absolute"})})))),o().createElement("div",{key:"child2",style:Object.assign(Object.assign({},I),{position:"absolute"}),className:"SplitterChild"},o().createElement(h.type,Object.assign({},h.props,{width:w,height:s}))))}},85155:(e,t,n)=>{"use strict";n.d(t,{F0:()=>i,ZL:()=>a});var r=n(45185),o=n(56271);const i=e=>{const{result:t}=(0,r.useHitherJob)(e?"createjob_get_recording_info":"",{recording_object:e},{useClientCache:!0});return t},a=e=>{const t=(0,o.useContext)(r.HitherContext),n=(0,o.useRef)({}),[,i]=(0,o.useState)(0),a={};return e.forEach((e=>{const r=e.recordingId;if(!n.current[r]){const o=t.createHitherJob("createjob_get_recording_info",{recording_object:e.recordingObject},{useClientCache:!0});n.current[r]=o,o.wait().then((()=>{i((e=>e+1))})).catch((()=>{i((e=>e+1))}))}n.current[r].result&&(a[r]=n.current[r].result)})),a}},21677:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(56271),o=n.n(r),i=n(65940),a=n(45157),l=n(16213);const s=e=>{const t=(0,r.useMemo)((()=>({layoutMode:"geom",electrodeIds:e.electrodes.map((e=>e.id)),electrodeLocations:e.electrodes.map((e=>[e.x,e.y])),width:e.width,height:e.height,selection:e.selection,selectionDispatch:e.selectionDispatch,electrodeOpts:{showLabels:!0,maxElectrodePixelRadius:25},noiseLevel:0,samplingFrequency:0})),[e]),n=(0,l.sJ)(i.N,t),s=(0,l.jU)([n]);return o().createElement(a.ZP,Object.assign({key:"electrodeGeometryCanvas",layers:s},{width:e.width,height:e.height}))}},5597:(e,t,n)=>{"use strict";n.d(t,{x:()=>r});const r=e=>{if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};const t=e.split("/"),n=t[2]||void 0,r=t[3]||void 0;return n&&r?{feedUri:`feed://${n}`,workspaceName:r}:{feedUri:void 0,workspaceName:void 0}}},45:(e,t,n)=>{"use strict";n.d(t,{j:()=>r,Z:()=>l});const r=(e,t)=>{if("SET_CURATION"===t.type)return t.curation;if("ADD_UNIT_LABEL"===t.type){const n=t.unitId+"",r=(e.labelsByUnit||{})[n]||[];return r.includes(t.label)?e:Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[n]:[...r,t.label].sort()})})}if("REMOVE_UNIT_LABEL"===t.type){const n=t.unitId+"",r=(e.labelsByUnit||{})[n]||[];return r.includes(t.label)?Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[n]:r.filter((e=>e!==t.label))})}):e}return"MERGE_UNITS"===t.type?Object.assign(Object.assign({},e),{mergeGroups:a([...e.mergeGroups||[],t.unitIds])}):"UNMERGE_UNITS"===t.type?Object.assign(Object.assign({},e),{mergeGroups:a((e.mergeGroups||[]).map((e=>e.filter((e=>!t.unitIds.includes(e))))))}):e},o=(e,t)=>e.filter((e=>t.includes(e))),i=(e,t)=>[...e,...t.filter((t=>!e.includes(t)))].sort(),a=e=>{const t=e.map((e=>[...e]));let n=!0;for(;n;){n=!1;for(let e=0;e<t.length;e++){const r=t[e];for(let a=e+1;a<t.length;a++){const l=t[a];o(r,l).length>0&&(t[e]=i(r,l),t[a]=[],n=!0)}}}return t.filter((e=>e.length>=2))},l=(e,t)=>{switch(t.type){case"ADD_RECORDING":return Object.assign(Object.assign({},e),{recordings:[...e.recordings.filter((e=>e.recordingId!==t.recording.recordingId)),t.recording]});case"DELETE_RECORDINGS":return Object.assign(Object.assign({},e),{recordings:e.recordings.filter((e=>!t.recordingIds.includes(e.recordingId)))});case"ADD_SORTING":return Object.assign(Object.assign({},e),{sortings:[...e.sortings.filter((e=>e.sortingId!==t.sorting.sortingId)),t.sorting]});case"DELETE_SORTINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!t.sortingIds.includes(e.sortingId)))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!t.recordingIds.includes(e.recordingId)))});case"SET_UNIT_METRICS_FOR_SORTING":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===t.unitMetricsForSorting.sortingId?Object.assign(Object.assign({},e),{unitMetricsUri:t.unitMetricsForSorting.metricsUri}):e))});default:return e}}},13534:(e,t,n)=>{"use strict";n.d(t,{Z:()=>J});var r=n(56271),o=n.n(r),i=n(45185),a=n(31222),l=n(85155),s=n(65405),c=n(49287),d=n(5597),g=n(45);const u=(0,i.createCalculationPool)({maxSimultaneous:6}),m=e=>{(0,r.useContext)(i.HitherContext);const{workspaceRoute:t,readOnly:n,sorting:m,recording:p,workspaceRouteDispatch:b}=e,[h,f]=(0,r.useReducer)(c.SF,{}),E=(0,s.D)(m.sortingObject,m.recordingObject),_=(0,l.F0)(p.recordingObject),k=m.sortingId,{feedUri:y,workspaceName:w}=(0,d.x)(t.workspaceUri),[x,R]=(0,r.useReducer)(g.j,(0,r.useMemo)((()=>({})),[])),I=(0,r.useCallback)((e=>{e.forEach((e=>R(e)))}),[]),S=(0,r.useMemo)((()=>({name:"sortingCuration",workspaceName:w,sortingId:k})),[w,k]),{appendMessages:v}=(0,i.useSubfeed)({feedUri:y,subfeedName:S,onMessages:I}),C=(0,r.useCallback)((e=>{v([e])}),[v]);(0,r.useEffect)((()=>{!h.timeRange&&_&&f({type:"SetTimeRange",timeRange:{min:0,max:Math.min(_.num_frames,_.sampling_frequency/10)}})}),[h,_]);const O=e.width||800,j=e.height||800,T=(0,r.useMemo)((()=>({position:"absolute",left:0,top:j-20,width:O,height:20,overflow:"hidden"})),[O,j,20]),D=O,M=j-20,L=(0,r.useMemo)((()=>({position:"absolute",left:0,top:0,width:D,height:M})),[D,M]),N=(0,i.usePlugins)(),U=(0,c.Sd)(N).filter((e=>"MVSortingView"===e.name))[0];if(!U)throw Error("Missing sorting view: MVSortingView");const B=(0,r.useMemo)((()=>U.props||{}),[U.props]),z=(0,r.useCallback)((()=>{b({type:"gotoRecordingPage",recordingId:p.recordingId})}),[b,p.recordingId]);return m?p?_?E?o().createElement("div",null,o().createElement("div",{style:L},o().createElement(U.component,Object.assign({},B,{sorting:m,recording:p,sortingInfo:E,recordingInfo:_,selection:h,selectionDispatch:f,curation:x,curationDispatch:C,readOnly:n,calculationPool:u,width:D,height:M}))),o().createElement("div",{style:T},"Sorting: ",m.sortingLabel," | Recording: ",o().createElement(a.Z,{onClick:z},p.recordingLabel))):o().createElement("h3",null,"Loading sorting info..."):o().createElement("h3",null,"Loading recording info..."):o().createElement("h3",null,`Recording not found: ${m.recordingId}`):o().createElement("h3",null,`Sorting not found: ${k}`)};var p=n(47033),b=n(88493),h=n(78048),f=n(96768);const E="import spikeextractors as se\nimport numpy as np\nimport labbox_ephys as le\nimport kachery_p2p as kp\n\n# adjust these values\nworkspace_uri = '{workspaceUri}'\nrecording_label = 'simulated_recording'\nduration_sec = 50 # duration of simulated recording\nnum_channels = 8 # num. channels in simulated recording\nnum_units = 5 # num units\nseed = 1 # random number generator seed\n\ndef prepare_recording_sorting():\n    # Simulate a recording (toy example)\n    recording, sorting = se.example_datasets.toy_example(duration=duration_sec, num_channels=num_channels, K=num_units, seed=seed)\n    R = le.LabboxEphysRecordingExtractor.from_memory(recording, serialize=True, serialize_dtype=np.int16)\n    S = le.LabboxEphysSortingExtractor.from_memory(sorting, serialize=True)\n    return R, S\n\nrecording, sorting_true = prepare_recording_sorting()\nsorting_label = 'true'\nworkspace = le.load_workspace(workspace_uri)\nprint(f'Workspace URI: {workspace.get_uri()}')\nR_id = workspace.add_recording(recording=recording, label=recording_label)\nS_id = workspace.add_sorting(sorting=sorting_true, recording_id=R_id, label=sorting_label)",_="import spikeextractors as se\nimport numpy as np\nimport labbox_ephys as le\nimport kachery_p2p as kp\n\n\n# Adjust these values\nrecording_label = 'despy_tet3'\nsorting_label = 'sorting'\nrecording_nwb_path = '<path or URI of nwb recording>'\nsorting_nwb_path = '<path or URI of nwb sorting>'\nworkspace_uri = '{workspaceUri}'\n\nrecording_uri = kp.store_object({\n    'recording_format': 'nwb',\n    'data': {\n        'path': recording_nwb_path\n    }\n})\nsorting_uri = kp.store_object({\n    'sorting_format': 'nwb',\n    'data': {\n        'path': sorting_nwb_path\n    }\n})\n\nsorting = le.LabboxEphysSortingExtractor(sorting_uri, samplerate=30000)\nrecording = le.LabboxEphysRecordingExtractor(recording_uri, download=True)\n\nworkspace = le.load_workspace(workspace_uri)\nprint(f'Workspace URI: {workspace.get_uri()}')\nR_id = workspace.add_recording(recording=recording, label=recording_label)\nS_id = workspace.add_sorting(sorting=sorting, recording_id=R_id, label=sorting_label)",k='import spikeextractors as se\nimport numpy as np\nimport labbox_ephys as le\nimport kachery_p2p as kp\n\n# Here are some examples to select from\nX1 = {\n    "label": "SF/synth_magland_noise10_K10_C4/001_synth",\n    "recording_uri": "sha1://f060669aadaa0f8ebe296bf72895df3899f8cf45/SF/synth_magland_noise10_K10_C4/001_synth.json",\n    "sorting_true_uri": "sha1://5b07e41bf62c045a549242c0caa866d272a33ab8/firings_true.mda"\n}\nX2 = {\n    "label": "SF/PAIRED_BOYDEN/paired_boyden32c/419_1_7",\n    "recording_uri": "sha1://759c81e6e20d3c352eaff6ce5d4dc7f948c45f25/SF/PAIRED_BOYDEN/paired_boyden32c/419_1_7.json",\n    "sorting_true_uri": "sha1://a5b7de64d7a2a96c0e1af70cdb2d4ae927e4949d/firings_true.mda"\n}\nX3 = {\n    "label": "SF/PAIRED_KAMPFF/paired_kampff/2014_11_25_Pair_3_0",\n    "recording_uri": "sha1://a205f87cef8b7f86df7a09cddbc79a1fbe5df60f/SF/PAIRED_KAMPFF/paired_kampff/2014_11_25_Pair_3_0.json",\n    "sorting_true_uri": "sha1://1cd517687aeca7ecdfaa9695680038d142a75031/firings_true.mda"\n}\n# To find more examples, see: https://github.com/flatironinstitute/spikeforest_recordings\n# However: note that some processing needs to be done to the files in this repo (to add the manifests to the raw data). This is WIP\n\n# Adjust these values ###########################\nX = X1 # Select example from above\nworkspace_uri = \'{workspaceUri}\'\n#################################################\n\nrecording_label = X[\'label\']\nrecording_uri = X[\'recording_uri\']\nsorting_true_uri = X[\'sorting_true_uri\']\nrecording = le.LabboxEphysRecordingExtractor(recording_uri, download=True)\nsorting_true = le.LabboxEphysSortingExtractor(sorting_true_uri, samplerate=30000)\n\nsorting_label = \'true\'\nworkspace = le.load_workspace(workspace_uri)\nprint(f\'Workspace URI: {workspace.get_uri()}\')\nR_id = workspace.add_recording(recording=recording, label=recording_label)\nS_id = workspace.add_sorting(sorting=sorting_true, recording_id=R_id, label=sorting_label)',y=e=>"```python\n"+e+"\n```",w=({text:e})=>{const[t,n]=(0,r.useState)(!1),i=(0,r.useCallback)((()=>{window.isSecureContext?(navigator.clipboard.writeText(e),n(!0),setTimeout((()=>{n(!1)}),3e3)):window.alert("Unable to copy to clipbard (not a secure context). This is probably because this site uses http rather than https.")}),[e]);return o().createElement("button",{onClick:i},t?"Copied":"Copy to clipboard")},x=({workspaceRoute:e})=>{const t=t=>((e,t)=>{let n=e;for(let e in t)n=n.split(`{${e}}`).join(t[e]||"");return n})(t,{workspaceUri:e.workspaceUri});return o().createElement("div",null,o().createElement(f.Z,{source:"## Importing recordings\n\nTo import a recording into labbox-ephys, you can run a Python script on the computer where labbox-ephys is installed, or from a kachery node that has the appropriate access. See the example scripts below."}),o().createElement(h.Z,{label:"Import example simulated recording"},o().createElement(w,{text:t(E)}),o().createElement(f.Z,{source:y(t(E))})),o().createElement(h.Z,{label:"Import SpikeForest recordings"},o().createElement(w,{text:t(k)}),o().createElement(f.Z,{source:y(t(k))})),o().createElement(h.Z,{label:"Import NWB recordings"},o().createElement(w,{text:t(_)}),o().createElement(f.Z,{source:y(t(_))})))};var R=n(12931),I=n(93379),S=n.n(I),v=n(39346);S()(v.Z,{insert:"head",singleton:!1}),v.Z.locals;const C=({title:e,rowKey:t,onDeleteRow:n})=>{const i=(0,r.useCallback)((()=>{n&&n(t)}),[n,t]);return o().createElement(p.IconButton,{title:e,onClick:i},o().createElement(R.Delete,null))},O=({title:e,rowKey:t,onConfirmDeleteRow:n})=>{const i=(0,r.useCallback)((()=>{n&&n(t,!0)}),[n,t]),a=(0,r.useCallback)((()=>{n&&n(t,!1)}),[n,t]);return o().createElement("span",null,"Confirm delete?",o().createElement(p.IconButton,{title:e,onClick:i},o().createElement(R.Delete,null)),o().createElement(p.IconButton,{title:"Cancel",onClick:a},"✖"))},j=({title:e,rowKey:t,onEditRow:n})=>o().createElement(p.IconButton,{title:e,onClick:()=>n&&n(t)},o().createElement(R.Edit,null)),T=({rows:e,columns:t,onDeleteRow:n,deleteRowLabel:i,onEditRow:a,editRowLabel:l,selectionMode:s="none",selectedRowKeys:c={},onSelectedRowKeysChanged:d})=>{const g=(0,r.useMemo)((()=>{const e={};return Object.keys(c).forEach((t=>{e[t]=c[t]})),e}),[c]),[u,m]=(0,r.useState)(null),b=(0,r.useCallback)((e=>{d&&("single"===s?e in g&&g[e]?d([]):d([e+""]):"multiple"===s&&d(Object.keys(g).filter((t=>t!=e&&g[t])).concat(g[e]?[]:[e.toString()])))}),[d,s,g]),h=(0,r.useCallback)((e=>{m(e)}),[]),f=(0,r.useCallback)(((e,t)=>{t&&n&&n(e),m(null)}),[n]),E=(0,r.useCallback)((e=>{a&&a(e)}),[a]);return o().createElement(p.Table,{className:"NiceTable"},o().createElement(p.TableHead,null,o().createElement(p.TableRow,null,o().createElement(p.TableCell,{key:"_first",style:{width:0}}),t.map((e=>o().createElement(p.TableCell,{key:e.key},o().createElement("span",null,e.label)))))),o().createElement(p.TableBody,null,e.map((e=>o().createElement(p.TableRow,{key:e.key},o().createElement(p.TableCell,null,n&&(u===e.key?o().createElement(O,{title:i||"",onConfirmDeleteRow:f,rowKey:e.key}):o().createElement(C,{title:i||"",onDeleteRow:h,rowKey:e.key})),a&&o().createElement(j,{title:l||"",onEditRow:E,rowKey:e.key}),"none"!==s&&o().createElement(p.Checkbox,{checked:g[e.key]||!1,onClick:()=>b(e.key)})),t.map((t=>{return o().createElement(p.TableCell,{key:t.key},o().createElement("span",null,0==(n=e.columnValues[t.key])?n:n?"object"==typeof n?n.element?n.element:n.text||"":n:""));var n})))))))};var D=n(436);S()(D.Z,{insert:"head",singleton:!1}),D.Z.locals;const M=e=>o().createElement("span",null,e.map((e=>{return t=e,o().createElement("span",{key:t.sortingId},t.sortingId," (","",")");var t}))),L=({recording:e,onClick:t})=>{const n=(0,r.useCallback)((()=>{t(e)}),[e,t]);return o().createElement(N,{title:"View recording",onClick:n},e.recordingLabel)},N=({title:e,children:t,onClick:n})=>o().createElement("button",{type:"button",className:"link-button",onClick:n},t),U=({recordings:e,sortings:t,onDeleteRecordings:n,readOnly:i,workspaceRouteDispatch:a})=>{const s=(0,r.useMemo)((()=>{const n={};return e.forEach((e=>{n[e.recordingId]=t.filter((t=>t.recordingId===e.recordingId))})),n}),[e,t]);var c;c="recordingLabel",e=e.sort((function(e,t){var n=e[c],r=t[c];return n<r?-1:n>r?1:0}));const d=(0,r.useCallback)((e=>{a({type:"gotoRecordingPage",recordingId:e.recordingId})}),[a]),g=(0,l.ZL)(e),u=(0,r.useMemo)((()=>e.map((e=>{const t=g[e.recordingId];return{key:e.recordingId,columnValues:{recording:e,recordingLabel:{text:e.recordingLabel,element:o().createElement(L,{onClick:d,recording:e})},numChannels:t?t.channel_ids.length:{element:o().createElement(p.CircularProgress,null)},samplingFrequency:t?t.sampling_frequency:"",durationMinutes:t?t.num_frames/t.sampling_frequency/60:"",sortings:{element:M(s[e.recordingId])}}}}))),[e,s,d,g]),m=(0,r.useCallback)((e=>{n&&n([e])}),[n]);return o().createElement("div",null,o().createElement(T,{rows:u,columns:[{key:"recordingLabel",label:"Recording"},{key:"numChannels",label:"Num. channels"},{key:"samplingFrequency",label:"Samp. freq. (Hz)"},{key:"durationMinutes",label:"Duration (min)"},{key:"sortings",label:"Sortings"}],deleteRowLabel:"Remove this recording",onDeleteRow:i?void 0:m}))},B=({width:e,height:t,sortings:n,recordings:i,onDeleteRecordings:a,workspaceRoute:l,workspaceRouteDispatch:s})=>{const[c,d]=(0,r.useState)(!1),g=(0,r.useCallback)((()=>{d(!0)}),[]);return o().createElement(b.Z,Object.assign({},{width:e,height:t},{initialPosition:300,positionFromRight:!0}),o().createElement("div",null,!c&&o().createElement("div",null,o().createElement(p.Button,{onClick:g},"Import recordings")),o().createElement(U,Object.assign({},{sortings:n,recordings:i,onDeleteRecordings:a,readOnly:!1,workspaceRouteDispatch:s}))),c&&o().createElement(x,{workspaceRoute:l}))};var z=n(36464),P=n(21677);const Z=({sampling_frequency:e,channel_ids:t,channel_groups:n,num_frames:r,noise_level:i})=>o().createElement(p.Table,{className:"NiceTable"},o().createElement(p.TableHead,null),o().createElement(p.TableBody,null,o().createElement(p.TableRow,null,o().createElement(p.TableCell,null,"Sampling frequency"),o().createElement(p.TableCell,null,e)),o().createElement(p.TableRow,null,o().createElement(p.TableCell,null,"Num. frames"),o().createElement(p.TableCell,null,r)),o().createElement(p.TableRow,null,o().createElement(p.TableCell,null,"Duration (min)"),o().createElement(p.TableCell,null,r/e/60)),o().createElement(p.TableRow,null,o().createElement(p.TableCell,null,"Num. channels"),o().createElement(p.TableCell,null,t.length)),o().createElement(p.TableRow,null,o().createElement(p.TableCell,null,"Channel IDs"),o().createElement(p.TableCell,null,t.length<20?A(t):A(t.slice(0,20))+" ...")),o().createElement(p.TableRow,null,o().createElement(p.TableCell,null,"Channel groups"),o().createElement(p.TableCell,null,n.length<20?A(n):A(n.slice(0,20))+" ...")),o().createElement(p.TableRow,null,o().createElement(p.TableCell,null,"Noise level"),o().createElement(p.TableCell,null,i))));function A(e){return e.map((e=>e+"")).join(", ")}const F=({recordingInfo:e,hideElectrodeGeometry:t})=>{const n=e,i=(0,r.useMemo)((()=>n?((e,t)=>{if(e&&t&&t.length!==e.length)throw Error("Electrode ID count does not match location count.");return t.map(((t,n)=>{const r=e[n];return{label:t+"",x:r[0],y:r[1],id:t}}))})(n.geom,n.channel_ids):[]),[n]),[a,l]=(0,r.useReducer)(c.Zl,{});return n?o().createElement(o().Fragment,null,o().createElement("div",{style:{width:600}},o().createElement(Z,{sampling_frequency:n.sampling_frequency,num_frames:n.num_frames,channel_ids:n.channel_ids,channel_groups:n.channel_groups,noise_level:n.noise_level})),!t&&o().createElement(P.Z,{electrodes:i,selection:a,selectionDispatch:l,width:350,height:150})):o().createElement("div",null,"No recording info found for recording.")},G="# Prerequisites:\n#    SpikeInterface/spikesorters: `pip install spikesorters`\n#    SpyKING CIRCUS: `pip install spyking-circus`\n#    On Ubuntu, the following are required for spyking circus:\n#        pip install pyqt5\n#        apt install qt5-default\n#    For more information: https://spyking-circus.readthedocs.io/en/latest/introduction/install.html\n\nimport spikeextractors as se\nimport numpy as np\nimport labbox_ephys as le\nfrom labbox_ephys import sorters\nimport kachery_p2p as kp\n\nif __name__ == '__main__':\n    # adjust these values\n    workspace_uri = '{workspaceUri}'\n    recording_id = '{recordingId}' # {recordingLabel}\n\n    workspace = le.load_workspace(workspace_uri)\n    le_recording = workspace.get_recording(recording_id)\n    recording_object = le_recording['recordingObject']\n\n    sorting_object = sorters.spykingcircus(\n        recording_object=recording_object,\n        detect_sign=-1,\n        adjacency_radius=100,\n        detect_threshold=6,\n        template_width_ms=3,\n        filter=True,\n        merge_spikes=True,\n        auto_merge=0.75,\n        num_workers=None,\n        whitening_max_elts=1000,\n        clustering_max_elts=10000\n    )\n    sorting = le.LabboxEphysSortingExtractor(sorting_object)\n\n    S_id = workspace.add_sorting(\n        sorting=sorting,\n        recording_id=recording_id,\n        label='spykingcircus'\n    )",H=({text:e})=>{const[t,n]=(0,r.useState)(!1),i=(0,r.useCallback)((()=>{window.isSecureContext?(navigator.clipboard.writeText(e),n(!0),setTimeout((()=>{n(!1)}),3e3)):window.alert("Unable to copy to clipbard (not a secure context). This is probably because this site uses http rather than https.")}),[e]);return o().createElement("button",{onClick:i},t?"Copied":"Copy to clipboard")},q=({workspaceRoute:e,recordingId:t,recordingLabel:n})=>{const r=r=>((e,t)=>{let n=e;for(let e in t)n=n.split(`{${e}}`).join(t[e]||"");return n})(r,{workspaceUri:e.workspaceUri,recordingId:t,recordingLabel:n});return o().createElement("div",null,o().createElement(f.Z,{source:"## Spike sorting\n\nUse one of the following scripts to run spike sorting and import the result into this workspace. You must\nrun the script on the computer where labbox-ephys is installed, or from a kachery node that has the appropriate access."}),o().createElement(h.Z,{label:"SpyKING CIRCUS"},o().createElement(H,{text:r(G)}),o().createElement(f.Z,{source:(i=r(G),"```python\n"+i+"\n```")})));var i},W=({sorting:e,onClick:t})=>{const n=(0,r.useCallback)((()=>{t(e)}),[e,t]);return o().createElement(K,{title:"View recording",onClick:n},e.sortingLabel)},K=({title:e,children:t,onClick:n})=>o().createElement("button",{type:"button",className:"link-button",onClick:n},t),X=({sortings:e,onDeleteSortings:t,readOnly:n,workspaceRouteDispatch:i})=>{const a=(0,r.useCallback)((e=>{i({type:"gotoSortingPage",recordingId:e.recordingId,sortingId:e.sortingId})}),[i]),l=(0,s.h)(e),c=(0,r.useMemo)((()=>{return t="sortingLabel",e.sort((function(e,n){var r=e[t],o=n[t];return r<o?-1:r>o?1:0}));var t}),[e]),d=(0,r.useMemo)((()=>c.map((e=>{const t=l[e.sortingId];return{key:e.sortingId,columnValues:{sorting:e,sortingLabel:{text:e.sortingLabel,element:o().createElement(W,{sorting:e,onClick:a})},numUnits:t?t.unit_ids.length:{element:o().createElement(p.CircularProgress,null)}}}}))),[c,a,l]),g=(0,r.useCallback)((e=>{t&&t([e])}),[t]);return o().createElement("div",null,o().createElement(T,{rows:d,columns:[{key:"sortingLabel",label:"Sorting"},{key:"numUnits",label:"Num. units"}],deleteRowLabel:"Remove this sorting",onDeleteRow:n?void 0:g}))},V=({sortings:e,workspaceRouteDispatch:t,workspaceRoute:n,onDeleteSortings:r})=>o().createElement(p.Paper,null,o().createElement("h3",null,`${e.length} sortings`),o().createElement(X,{sortings:e,workspaceRouteDispatch:t,readOnly:!1,onDeleteSortings:r})),$=(0,i.createCalculationPool)({maxSimultaneous:6}),Y=({recording:e,sortings:t,workspaceRoute:n,workspaceRouteDispatch:a,onDeleteSortings:s,width:d,height:g})=>{const u=(0,l.F0)(e.recordingObject),[m,f]=(0,r.useState)(!1),[E,_]=(0,r.useReducer)(c.Zl,{});(0,r.useEffect)((()=>{!E.timeRange&&u&&_({type:"SetTimeRange",timeRange:{min:0,max:Math.min(u.num_frames,u.sampling_frequency/10)}})}),[E,u]);const k=(0,r.useCallback)((()=>{a({type:"gotoRecordingsPage"})}),[a]),y=(0,i.usePlugins)(),w=(0,r.useMemo)((()=>(0,c._S)(y)),[y]);if(!u)return o().createElement("div",null,"Loading recording info");const x=o().createElement("div",{style:{margin:20}},o().createElement(p.Grid,{container:!0,spacing:3},o().createElement(p.Grid,{item:!0,xs:12,xl:6},o().createElement(p.Button,{onClick:k},"Back to recordings"),o().createElement("h2",null,e.recordingLabel),o().createElement("div",null,e.recordingPath),o().createElement(F,{recordingInfo:u,hideElectrodeGeometry:!0})),o().createElement(p.Grid,{item:!0,xs:12,xl:6},o().createElement(V,{sortings:t,workspaceRouteDispatch:a,workspaceRoute:n,onDeleteSortings:s}))),(0,z.Z)(w).filter((e=>!e.disabled)).map((t=>o().createElement(h.Z,{label:t.label,defaultExpanded:!!t.defaultExpanded,key:"rv-"+t.name},o().createElement(t.component,{key:"rvc-"+t.name,calculationPool:$,recording:e,recordingInfo:u,selection:E,selectionDispatch:_,width:d-40})))));return o().createElement(b.Z,Object.assign({},{width:d,height:g},{initialPosition:300,positionFromRight:!0}),o().createElement("div",null,!m&&o().createElement("div",null,o().createElement(p.Button,{onClick:()=>{f(!0)}},"Spike sorting")),x),m&&o().createElement(q,{workspaceRoute:n,recordingId:e.recordingId,recordingLabel:e.recordingLabel}))},J=({workspace:e,workspaceDispatch:t,workspaceRoute:n,workspaceRouteDispatch:i,width:a=500,height:l=500})=>{const s=(0,r.useCallback)((e=>{t({type:"DELETE_RECORDINGS",recordingIds:e})}),[t]),c=(0,r.useCallback)((e=>{t({type:"DELETE_SORTINGS",sortingIds:e})}),[t]);switch(n.page){case"recordings":return o().createElement(B,Object.assign({onDeleteRecordings:s},{width:a,height:l,recordings:e.recordings,sortings:e.sortings,workspaceRoute:n,workspaceRouteDispatch:i}));case"recording":{const t=n.recordingId,r=e.recordings.filter((e=>e.recordingId===t))[0];return r?o().createElement(Y,Object.assign({onDeleteSortings:c},{width:a,height:l,recording:r,workspaceRouteDispatch:i,workspaceRoute:n},{sortings:e.sortings.filter((e=>e.recordingId===t))})):o().createElement("div",null,"Recording not found: ",t)}case"sorting":{const t=n.recordingId,r=e.recordings.filter((e=>e.recordingId===t))[0];if(!r)return o().createElement("div",null,"Recording not found: ",t);const s=n.sortingId,c=e.sortings.filter((e=>e.recordingId===t&&e.sortingId===s))[0];return c?o().createElement(m,{sorting:c,recording:r,width:a,height:l,readOnly:!1,workspaceRoute:n,workspaceRouteDispatch:i}):o().createElement("div",null,"Sorting not found: ",t,"/",s)}}}},39346:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(23645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,".NiceTable .MuiTableCell-root {\n    padding-top: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n    padding-right: 5px;\n}\n\n.NiceTable .MuiIconButton-root {\n    padding: 1px;\n}",""]);const i=o},436:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(23645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,".link-button {\n  background-color: transparent;\n  border: none;\n  cursor: pointer;\n  text-decoration: underline;\n  display: inline;\n  margin: 0;\n  padding: 0;\n}\n\n.link-button:hover,\n.link-button:focus {\ntext-decoration: none;\n}",""]);const i=o}}]);