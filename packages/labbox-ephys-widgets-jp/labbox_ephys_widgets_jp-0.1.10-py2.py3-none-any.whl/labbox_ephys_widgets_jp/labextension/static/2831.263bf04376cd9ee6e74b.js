(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[2831],{2831:(e,t,n)=>{"use strict";n.d(t,{Z:()=>B});var l=n(47033),a=n(56271),o=n.n(a),r=n(49287),s=n(45185),c=n(31222);const i=()=>{const[e,t]=(0,a.useState)([]),n=(0,a.useContext)(s.HitherContext);return(0,a.useEffect)((()=>{const e=setInterval((()=>{const e=n.getHitherJobs();t(e)}),1e3);return()=>{clearInterval(e)}}),[n]),{pendingJobs:e.filter((e=>"pending"===e.status)),runningJobs:e.filter((e=>"running"===e.status)),finishedJobs:e.filter((e=>"finished"===e.status)),erroredJobs:e.filter((e=>"error"===e.status)),allJobs:e}},u=({onClick:e})=>{const{pendingJobs:t,runningJobs:n,finishedJobs:l,erroredJobs:a}=i(),r=t.length,s=n.length,u=l.length,m=a.length,p=`Jobs: ${r} pending | ${s} running | ${u} finished | ${m} errored`,d=m>0?o().createElement("span",null,":",o().createElement("span",{style:{color:"pink"}},m)):o().createElement("span",null);return o().createElement(c.Z,{onClick:e,color:"white"},o().createElement("span",{title:p,style:{fontFamily:"courier"}},r,":",s,":",u,d))};var m=n(12931);const p=({color:e})=>{const{websocketStatus:t,onReconnectWebsocket:n}=(0,a.useContext)(s.LabboxProviderContext),{icon:r,title:c}=(0,a.useMemo)((()=>{switch(t){case"waiting":return{icon:o().createElement(m.Sync,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:o().createElement(m.CheckCircleOutline,{style:{color:e}}),title:"Connected"};case"disconnected":return{icon:o().createElement(m.SyncProblem,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[t,e]),i=(0,a.useCallback)((()=>{"disconnected"===t&&n()}),[t,n]);return o().createElement(l.IconButton,{title:c,onClick:i},r)},d=({onOpenSettings:e,color:t})=>{const{icon:n,title:r}=(0,a.useMemo)((()=>({icon:o().createElement(m.Settings,null),title:"Open settings"})),[]),s=(0,a.useCallback)((()=>{e()}),[e]);return o().createElement(l.IconButton,{style:{color:t},title:r,onClick:s},n)},b={paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold",cursor:"pointer"},g=({onOpenSettings:e,onOpenJobMonitor:t,workspaceRouteDispatch:n,logo:r})=>{const s=(0,a.useCallback)((()=>{n({type:"gotoRecordingsPage"})}),[n]);return o().createElement(l.AppBar,{position:"static",style:{height:50,color:"white"}},o().createElement(l.Toolbar,null,r&&o().createElement("img",{src:r,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:s}),"   ",o().createElement("div",{style:b,onClick:s},"Labbox Ephys"),o().createElement("span",{style:{marginLeft:"auto"}}),o().createElement("span",{style:{paddingBottom:0,color:"white"}},o().createElement(d,{onOpenSettings:e,color:"white"}),o().createElement(p,{color:"white"}),o().createElement(u,{onClick:t}))))};var E=n(41120);const h=({job:e})=>{const t=e.kwargs&&k(e.kwargs).length>50,n=e.kwargs&&k(e.kwargs).length>1e3,[r,s]=(0,a.useState)(!t),c=e.result&&k(e.result).length>50,i=e.result&&k(e.result).length>1e3,[u,m]=(0,a.useState)(!c),p=r?o().createElement("div",null,t&&o().createElement(l.Button,{onClick:()=>s(!1)},"Collapse"),o().createElement("pre",null,e.kwargs?k(e.kwargs):"")):n?o().createElement(l.Button,{onClick:()=>{console.info(e.kwargs)},title:"Write input argumetns to the browser developer tools console"},"Write input arguments to console"):o().createElement(l.Button,{onClick:()=>{console.info(e.kwargs),s(!0)}},"Expand"),d=u?o().createElement("div",null,c&&o().createElement(l.Button,{onClick:()=>m(!1)},"Collapse"),o().createElement("pre",null,e.result?k(e.result):"")):i?o().createElement(l.Button,{onClick:()=>{console.info(e.result)},title:"Write result to the browser developer tools console"},"Write result to console"):o().createElement(l.Button,{onClick:()=>{console.info(e.result),m(!0)}},"Expand"),b=[{label:"Job ID",value:e.jobId},{label:"Function name",value:e.functionName},{label:"Input arguments",value:p},{label:"Status",value:e.status},{label:"Started",value:e.timestampStarted?w(new Date(e.timestampStarted)):""},{label:"Finished",value:e.timestampFinished?w(new Date(e.timestampFinished)):""},{label:"Result",value:d},{label:"Error message",value:e.error_message}];return o().createElement("div",null,o().createElement(l.Table,{className:"NiceTable"},o().createElement(l.TableHead,null),o().createElement(l.TableBody,null,b.map((e=>o().createElement(l.TableRow,{key:e.label},o().createElement(l.TableCell,null,e.label),o().createElement(l.TableCell,null,e.value)))))))};function k(e){return JSON.stringify(e,null,4)}function w(e){let t="";var n,l;return n=e,l=new Date,(n.getFullYear()!==l.getFullYear()||n.getMonth()!==l.getMonth()||n.getDate()!==l.getDate())&&(t+=`${e.getMonth()+1}/${e.getDate()}/${e.getFullYear()}} `),t+=`${e.toLocaleTimeString()}`,t}const C=({job:e,onBack:t})=>o().createElement("div",null,o().createElement("p",null,o().createElement(c.Z,{onClick:t},"Back to jobs")),o().createElement(h,{job:e}));var f=n(62330);function v(e){let t="";var n,l;return n=e,l=new Date,(n.getFullYear()!==l.getFullYear()||n.getMonth()!==l.getMonth()||n.getDate()!==l.getDate())&&(t+=`${e.getMonth()+1}/${e.getDate()}/${e.getFullYear()}} `),t+=`${e.toLocaleTimeString()}`,t}const y=({onClick:e})=>o().createElement(l.IconButton,{title:"Cancel job",onClick:e},o().createElement(m.Delete,null)),S=({jobs:e,onViewJob:t,onCancelJob:n})=>{const l=(0,a.useMemo)((()=>[{key:"jobId",label:"Job"},{key:"functionName",label:"Function"},{key:"status",label:"Status"},{key:"started",label:"Started"},{key:"finished",label:"Finished"},{key:"message",label:"Message"}]),[]),r=(0,a.useMemo)((()=>[...e].sort(((e,t)=>"running"===e.status&&"running"!==t.status?-1:"running"===t.status&&"running"!==e.status?1:e.timestampStarted&&t.timestampStarted?e.timestampStarted<t.timestampStarted?1:t.timestampStarted<e.timestampStarted?-1:0:0))),[e]),s=(0,a.useMemo)((()=>r.map((e=>({key:e.jobId||"null",columnValues:{jobId:{text:e.jobId,element:o().createElement(c.Z,{onClick:()=>{t&&t(e)}},e.jobId)},functionName:{text:e.functionName},status:{text:e.status,element:"running"===e.status?o().createElement("span",null,o().createElement("span",null,e.status," "),o().createElement(y,{onClick:()=>{n&&n(e)}})):o().createElement("span",null,e.status)},started:{text:e.timestampStarted?v(new Date(e.timestampStarted)):""},finished:{text:e.timestampFinished?v(new Date(e.timestampFinished)):""},message:{text:e.error_message||""}}})))),[r]);return o().createElement(f.Z,{rows:s,columns:l})},x=(0,E.Z)((e=>({paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}))),D=()=>{const e=x(),{allJobs:t}=i(),[n,l]=(0,a.useState)(null),r=(0,a.useCallback)((e=>{l(e)}),[]),s=(0,a.useCallback)((()=>{}),[]),c=(0,a.useCallback)((()=>{l(null)}),[]);return o().createElement("div",{className:e.paper,style:{zIndex:9999}},o().createElement("h2",null,"Job Monitor"),n?o().createElement(C,{job:n,onBack:c}):o().createElement(S,{jobs:t,onViewJob:r,onCancelJob:s}))};var T=n(5597);const I=(0,E.Z)((e=>({paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}))),J=({workspaceUri:e,version:t})=>{const n=I(),{serverInfo:r}=(0,a.useContext)(s.LabboxProviderContext),{workspaceName:c}=(0,T.x)(e);return o().createElement("div",{className:n.paper,style:{zIndex:9999}},o().createElement("h2",null,"Labbox Ephys ",t),o().createElement(l.Table,null,o().createElement(l.TableRow,null,o().createElement(l.TableCell,null,"Workspace URI"),o().createElement(l.TableCell,null,e||"")),o().createElement(l.TableRow,null,o().createElement(l.TableCell,null,"Workspace name"),o().createElement(l.TableCell,null,c)),o().createElement(l.TableRow,null,o().createElement(l.TableCell,null,"Kachery node ID"),o().createElement(l.TableCell,null,r?r.nodeId:"")),o().createElement(l.TableRow,null,o().createElement(l.TableCell,null,"Default feed ID"),o().createElement(l.TableCell,null,r?r.defaultFeedId:""))))};function F(){const{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}const B=({workspace:e,workspaceDispatch:t,workspaceRoute:n,workspaceRouteDispatch:s,version:c,width:i,height:u})=>{const{width:m,height:p}=function(){const[e,t]=(0,a.useState)(F());return(0,a.useEffect)((()=>{function e(){t(F())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),d=(u||p)-52-2,b=(i||m)-0-2,E=(0,r.FO)().filter((e=>"WorkspaceView"===e.name))[0];if(!E)throw Error("Unable to find workspace view plugin");const[h,k]=(0,a.useState)(!1),[w,C]=(0,a.useState)(!1),f=(0,a.useCallback)((()=>{k(!0)}),[]),v=(0,a.useCallback)((()=>{C(!0)}),[]),y=(0,a.useCallback)((()=>{k(!1)}),[]),S=(0,a.useCallback)((()=>{C(!1)}),[]);return o().createElement("div",{style:{margin:0}},o().createElement(g,{onOpenSettings:f,onOpenJobMonitor:v,workspaceRouteDispatch:s}),o().createElement("div",{style:{position:"absolute",top:52}},o().createElement(E.component,{width:b,height:d,workspace:e,workspaceDispatch:t,workspaceRoute:n,workspaceRouteDispatch:s})),o().createElement(l.Modal,{open:h,onClose:y,style:{zIndex:9999}},o().createElement("span",null,o().createElement(J,{workspace:e,workspaceUri:n.workspaceUri,version:c}))),o().createElement(l.Modal,{open:w,onClose:S,style:{zIndex:9999}},o().createElement("span",null,o().createElement(D,null))))}},41120:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var l=n(22122),a=n(73914),o=n(99700);const r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.Z)(e,(0,l.Z)({defaultTheme:o.Z},t))}}}]);