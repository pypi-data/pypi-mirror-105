(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[3553],{83553:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>k,useWorkspaceRoute:()=>U});var t=s(47033),i=s(45185),n=s(56271),o=s.n(n),a=s(2831),c=s(5597),d=s(45),g=s(40390),u=s.n(g);const l=(e,r)=>{const s=e.pathname.split("/"),t=u().parse(e.search.slice(1)).workspace||"default",i=null==r?void 0:r.defaultFeedId,n=t.startsWith("workspace://")?t:i?`workspace://${i}/${t}`:void 0,o=s[1]||"recordings";if(!["recordings","recording","sorting"].includes(o))throw Error(`Invalid page: ${o}`);switch(o){case"recordings":return{workspaceUri:n,page:o};case"recording":return{workspaceUri:n,page:o,recordingId:s[2]};case"sorting":return{workspaceUri:n,page:o,recordingId:s[2]||"",sortingId:s[3]||""};default:return{workspaceUri:n,page:"recordings"}}};var p=e=>{const r=Object.keys(e);return 0===r.length?"":"?"+r.map((r=>encodeURIComponent(r)+"="+encodeURIComponent(e[r]))).join("&")},f=s(96734),b=s(34446),h=s(93633);const I={palette:{primary:f.Z,secondary:b.Z},overrides:{MuiAccordionSummary:{root:{"&$expanded":{minHeight:0,maxHeight:30,paddingTop:10},minHeight:0}},MuiToolbar:{regular:{minHeight:48,"@media(min-width:600px)":{minHeight:48}}},MuiTabs:{root:{minHeight:30,maxHeight:30}},MuiTab:{root:{minHeight:30,maxHeight:30,padding:"6px 0px"}}}},m=(0,h.Z)(I);var O=s(18657);const U=(e,r,s)=>{const t=(0,n.useMemo)((()=>t=>{const i=l(r.location,{}),n=(e=>{const r={};switch(e.workspaceUri&&(r.workspace=e.workspaceUri),e.page){case"recordings":return{pathname:"/",search:p(r)};case"recording":return{pathname:`/recording/${e.recordingId}`,search:p(r)};case"sorting":return{pathname:`/sorting/${e.recordingId}/${e.sortingId}`,search:p(r)}}})(((e,r)=>{let s=e;switch(r.type){case"gotoRecordingsPage":s={page:"recordings",workspaceUri:e.workspaceUri};break;case"gotoRecordingPage":s={page:"recording",recordingId:r.recordingId,workspaceUri:e.workspaceUri};break;case"gotoSortingPage":s={page:"sorting",recordingId:r.recordingId,sortingId:r.sortingId,workspaceUri:e.workspaceUri}}return s})(Object.assign(Object.assign({},i),{workspaceUri:s}),t));n.pathname===e.pathname&&n.search===e.search||r.push(n)}),[e,r]);return[(0,n.useMemo)((()=>l(e,{})),[e]),t]},k=({workspaceUri:e,onWorkspaceRouteChanged:r})=>{(0,i.usePlugins)();const s=(0,n.useCallback)((e=>{e.forEach((e=>{e.action&&f(e.action)}))}),[]),{feedUri:g}=(0,c.x)(e),{appendMessages:u,loadedInitialMessages:l}=(0,i.useSubfeed)({feedUri:g,subfeedName:"main",onMessages:s}),[p,f]=(0,n.useReducer)(d.Z,{recordings:[],sortings:[]}),b=(0,n.useCallback)((e=>{u([{action:e}])}),[u]),[h,I]=(0,n.useState)(null),[k,w]=(0,n.useState)(void 0),[j,E]=(0,n.useState)(void 0),[R,S]=(0,n.useState)(0),_=o().useCallback((e=>{I(e)}),[]);(0,n.useEffect)((()=>{h&&(k!==h.offsetWidth&&w(h.offsetWidth),j!==h.offsetHeight&&E(h.offsetHeight))}),[h,k,j,w,E,R]),function(e,r){const s=(0,n.useRef)();(0,n.useEffect)((()=>{s.current=e})),(0,n.useEffect)((()=>{{const e=setInterval((function(){void 0!==(null==s?void 0:s.current)&&(null==s||s.current())}),r);return()=>clearInterval(e)}}),[r])}((()=>{S(R+1)}),1e3);const[v,T]=(0,n.useState)({pathname:"",search:"?"}),[y,M]=(0,n.useState)([]),N=(0,n.useMemo)((()=>({location:v,push:e=>{M([...y,v]),T(e)}})),[v,y]),[D,C]=U(v,N,e);return(0,n.useEffect)((()=>{r&&r(D)}),[D,r]),o().createElement(t.MuiThemeProvider,{theme:m},o().createElement("div",{ref:_,className:"WorkspaceViewWrapper",style:{position:"absolute",left:0,right:0,top:0,bottom:0}},o().createElement(a.Z,{workspace:p,workspaceDispatch:b,workspaceRoute:D,workspaceRouteDispatch:C,version:O.Z,width:k||700,height:j||700})))}},5597:(e,r,s)=>{"use strict";s.d(r,{x:()=>t});const t=e=>{if(!e)return{feedUri:void 0,feedId:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,feedId:void 0};const r=e.split("?")[0].split("/")[2]||void 0;return r?{feedId:r,feedUri:`feed://${r}`}:{feedUri:void 0,feedId:void 0}}},45:(e,r,s)=>{"use strict";s.d(r,{j:()=>t,Z:()=>a});const t=(e,r)=>{if("SET_CURATION"===r.type)return r.curation;if("ADD_UNIT_LABEL"===r.type){const s=r.unitId+"",t=(e.labelsByUnit||{})[s]||[];return t.includes(r.label)?e:Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[s]:[...t,r.label].sort()})})}if("REMOVE_UNIT_LABEL"===r.type){const s=r.unitId+"",t=(e.labelsByUnit||{})[s]||[];return t.includes(r.label)?Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[s]:t.filter((e=>e!==r.label))})}):e}return"MERGE_UNITS"===r.type?Object.assign(Object.assign({},e),{mergeGroups:o([...e.mergeGroups||[],r.unitIds])}):"UNMERGE_UNITS"===r.type?Object.assign(Object.assign({},e),{mergeGroups:o((e.mergeGroups||[]).map((e=>e.filter((e=>!r.unitIds.includes(e))))))}):e},i=(e,r)=>e.filter((e=>r.includes(e))),n=(e,r)=>[...e,...r.filter((r=>!e.includes(r)))].sort(),o=e=>{const r=e.map((e=>[...e]));let s=!0;for(;s;){s=!1;for(let e=0;e<r.length;e++){const t=r[e];for(let o=e+1;o<r.length;o++){const a=r[o];i(t,a).length>0&&(r[e]=n(t,a),r[o]=[],s=!0)}}}return r.filter((e=>e.length>=2))},a=(e,r)=>{switch(r.type){case"ADD_RECORDING":return Object.assign(Object.assign({},e),{recordings:[...e.recordings.filter((e=>e.recordingId!==r.recording.recordingId)),r.recording]});case"DELETE_RECORDINGS":return Object.assign(Object.assign({},e),{recordings:e.recordings.filter((e=>!r.recordingIds.includes(e.recordingId)))});case"ADD_SORTING":return Object.assign(Object.assign({},e),{sortings:[...e.sortings.filter((e=>e.sortingId!==r.sorting.sortingId)),r.sorting]});case"DELETE_SORTINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!r.sortingIds.includes(e.sortingId)))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!r.recordingIds.includes(e.recordingId)))});case"SET_UNIT_METRICS_FOR_SORTING":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===r.unitMetricsForSorting.sortingId?Object.assign(Object.assign({},e),{unitMetricsUri:r.unitMetricsForSorting.metricsUri}):e))});default:return e}}},96734:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});const t={50:"#ede7f6",100:"#d1c4e9",200:"#b39ddb",300:"#9575cd",400:"#7e57c2",500:"#673ab7",600:"#5e35b1",700:"#512da8",800:"#4527a0",900:"#311b92",A100:"#b388ff",A200:"#7c4dff",A400:"#651fff",A700:"#6200ea"}}}]);