(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[3553],{83553:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>w,useWorkspaceRoute:()=>k});var t=r(47033),i=r(45185),n=r(56271),a=r.n(n),c=r(2831),o=r(5597),g=r(45),d=r(40390),u=r.n(d);const l=(e,s)=>{const r=e.pathname.split("/"),t=u().parse(e.search.slice(1)).workspace||"default",i=null==s?void 0:s.defaultFeedId,n=t.startsWith("workspace://")?t:i?`workspace://${i}/${t}`:void 0,a=r[1]||"recordings";if(!["recordings","recording","sorting"].includes(a))throw Error(`Invalid page: ${a}`);switch(a){case"recordings":return{workspaceUri:n,page:a};case"recording":return{workspaceUri:n,page:a,recordingId:r[2]};case"sorting":return{workspaceUri:n,page:a,recordingId:r[2]||"",sortingId:r[3]||""};default:return{workspaceUri:n,page:"recordings"}}};var p=e=>{const s=Object.keys(e);return 0===s.length?"":"?"+s.map((s=>encodeURIComponent(s)+"="+encodeURIComponent(e[s]))).join("&")},b=r(96734),f=r(34446),h=r(93633);const I={palette:{primary:b.Z,secondary:f.Z},overrides:{MuiAccordionSummary:{root:{"&$expanded":{minHeight:0,maxHeight:30,paddingTop:10},minHeight:0}},MuiToolbar:{regular:{minHeight:48,"@media(min-width:600px)":{minHeight:48}}},MuiTabs:{root:{minHeight:30,maxHeight:30}},MuiTab:{root:{minHeight:30,maxHeight:30,padding:"6px 0px"}}}},m=(0,h.Z)(I);var O=r(18657);const k=(e,s,r)=>{const t=(0,n.useMemo)((()=>t=>{const i=l(s.location,{}),n=(e=>{const s={};switch(e.workspaceUri&&(s.workspace=e.workspaceUri),e.page){case"recordings":return{pathname:"/",search:p(s)};case"recording":return{pathname:`/recording/${e.recordingId}`,search:p(s)};case"sorting":return{pathname:`/sorting/${e.recordingId}/${e.sortingId}`,search:p(s)}}})(((e,s)=>{let r=e;switch(s.type){case"gotoRecordingsPage":r={page:"recordings",workspaceUri:e.workspaceUri};break;case"gotoRecordingPage":r={page:"recording",recordingId:s.recordingId,workspaceUri:e.workspaceUri};break;case"gotoSortingPage":r={page:"sorting",recordingId:s.recordingId,sortingId:s.sortingId,workspaceUri:e.workspaceUri}}return r})(Object.assign(Object.assign({},i),{workspaceUri:r}),t));n.pathname===e.pathname&&n.search===e.search||s.push(n)}),[e,s]);return[(0,n.useMemo)((()=>l(e,{})),[e]),t]},w=({workspaceUri:e,onWorkspaceRouteChanged:s})=>{(0,i.usePlugins)();const r=(0,n.useCallback)((e=>{e.forEach((e=>{e.action&&h(e.action)}))}),[]),{feedUri:d,workspaceName:u}=(0,o.x)(e),l=(0,n.useMemo)((()=>({workspaceName:u||""})),[u]),{appendMessages:p,loadedInitialMessages:b}=(0,i.useSubfeed)({feedUri:d,subfeedName:l,onMessages:r}),[f,h]=(0,n.useReducer)(g.Z,{recordings:[],sortings:[]}),I=(0,n.useCallback)((e=>{p([{action:e}])}),[p]),[w,j]=(0,n.useState)(null),[U,E]=(0,n.useState)(void 0),[R,S]=(0,n.useState)(void 0),[_,T]=(0,n.useState)(0),y=a().useCallback((e=>{j(e)}),[]);(0,n.useEffect)((()=>{w&&(U!==w.offsetWidth&&E(w.offsetWidth),R!==w.offsetHeight&&S(w.offsetHeight))}),[w,U,R,E,S,_]),function(e,s){const r=(0,n.useRef)();(0,n.useEffect)((()=>{r.current=e})),(0,n.useEffect)((()=>{{const e=setInterval((function(){void 0!==(null==r?void 0:r.current)&&(null==r||r.current())}),s);return()=>clearInterval(e)}}),[s])}((()=>{T(_+1)}),1e3);const[M,N]=(0,n.useState)({pathname:"",search:"?"}),[v,D]=(0,n.useState)([]),C=(0,n.useMemo)((()=>({location:M,push:e=>{D([...v,M]),N(e)}})),[M,v]),[G,A]=k(M,C,e);return(0,n.useEffect)((()=>{s&&s(G)}),[G,s]),a().createElement(t.MuiThemeProvider,{theme:m},a().createElement("div",{ref:y,className:"WorkspaceViewWrapper",style:{position:"absolute",left:0,right:0,top:0,bottom:0}},a().createElement(c.Z,{workspace:f,workspaceDispatch:I,workspaceRoute:G,workspaceRouteDispatch:A,version:O.Z,width:U||700,height:R||700})))}},45:(e,s,r)=>{"use strict";r.d(s,{j:()=>t,Z:()=>c});const t=(e,s)=>{if("SET_CURATION"===s.type)return s.curation;if("ADD_UNIT_LABEL"===s.type){const r=s.unitId+"",t=(e.labelsByUnit||{})[r]||[];return t.includes(s.label)?e:Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[r]:[...t,s.label].sort()})})}if("REMOVE_UNIT_LABEL"===s.type){const r=s.unitId+"",t=(e.labelsByUnit||{})[r]||[];return t.includes(s.label)?Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[r]:t.filter((e=>e!==s.label))})}):e}return"MERGE_UNITS"===s.type?Object.assign(Object.assign({},e),{mergeGroups:a([...e.mergeGroups||[],s.unitIds])}):"UNMERGE_UNITS"===s.type?Object.assign(Object.assign({},e),{mergeGroups:a((e.mergeGroups||[]).map((e=>e.filter((e=>!s.unitIds.includes(e))))))}):e},i=(e,s)=>e.filter((e=>s.includes(e))),n=(e,s)=>[...e,...s.filter((s=>!e.includes(s)))].sort(),a=e=>{const s=e.map((e=>[...e]));let r=!0;for(;r;){r=!1;for(let e=0;e<s.length;e++){const t=s[e];for(let a=e+1;a<s.length;a++){const c=s[a];i(t,c).length>0&&(s[e]=n(t,c),s[a]=[],r=!0)}}}return s.filter((e=>e.length>=2))},c=(e,s)=>{switch(s.type){case"ADD_RECORDING":return Object.assign(Object.assign({},e),{recordings:[...e.recordings.filter((e=>e.recordingId!==s.recording.recordingId)),s.recording]});case"DELETE_RECORDINGS":return Object.assign(Object.assign({},e),{recordings:e.recordings.filter((e=>!s.recordingIds.includes(e.recordingId)))});case"ADD_SORTING":return Object.assign(Object.assign({},e),{sortings:[...e.sortings.filter((e=>e.sortingId!==s.sorting.sortingId)),s.sorting]});case"DELETE_SORTINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!s.sortingIds.includes(e.sortingId)))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!s.recordingIds.includes(e.recordingId)))});case"SET_UNIT_METRICS_FOR_SORTING":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===s.unitMetricsForSorting.sortingId?Object.assign(Object.assign({},e),{unitMetricsUri:s.unitMetricsForSorting.metricsUri}):e))});default:return e}}},96734:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});const t={50:"#ede7f6",100:"#d1c4e9",200:"#b39ddb",300:"#9575cd",400:"#7e57c2",500:"#673ab7",600:"#5e35b1",700:"#512da8",800:"#4527a0",900:"#311b92",A100:"#b388ff",A200:"#7c4dff",A400:"#651fff",A700:"#6200ea"}}}]);