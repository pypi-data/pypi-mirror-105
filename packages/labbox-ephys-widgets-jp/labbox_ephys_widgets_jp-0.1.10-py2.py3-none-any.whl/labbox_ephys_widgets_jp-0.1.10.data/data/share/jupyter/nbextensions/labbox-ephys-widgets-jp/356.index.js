(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[356],{45792:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var l=n(60352),a=n.n(l)()((function(e){return e[1]}));a.push([e.id,".NiceTable .MuiTableCell-root {\n    padding-top: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n    padding-right: 5px;\n}\n\n.NiceTable .MuiIconButton-root {\n    padding: 1px;\n}",""]);const s=a},20864:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var l=n(69297),a=n.n(l);const s=({color:e,onClick:t,children:n})=>{let l={color:e||"gray",cursor:"pointer",textDecoration:"underline"};return a().createElement("span",{style:l,onClick:t},n)}},67539:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var l=n(22682),a=n(37450),s=n(2197),r=n(92378),o=n(62198),i=n(12930),c=n(39110),u=n(23801),m=n(816),d=n(69297),p=n.n(d),g=n(93379),b=n.n(g),E=n(45792);b()(E.Z,{insert:"head",singleton:!1}),E.Z.locals;const k=({title:e,rowKey:t,onDeleteRow:n})=>{const l=(0,d.useCallback)((()=>{n&&n(t)}),[n,t]);return p().createElement(c.Z,{title:e,onClick:l},p().createElement(u.Z,null))},w=({title:e,rowKey:t,onConfirmDeleteRow:n})=>{const l=(0,d.useCallback)((()=>{n&&n(t,!0)}),[n,t]),a=(0,d.useCallback)((()=>{n&&n(t,!1)}),[n,t]);return p().createElement("span",null,"Confirm delete?",p().createElement(c.Z,{title:e,onClick:l},p().createElement(u.Z,null)),p().createElement(c.Z,{title:"Cancel",onClick:a},"✖"))},h=({title:e,rowKey:t,onEditRow:n})=>p().createElement(c.Z,{title:e,onClick:()=>n&&n(t)},p().createElement(m.Z,null)),y=({rows:e,columns:t,onDeleteRow:n,deleteRowLabel:c,onEditRow:u,editRowLabel:m,selectionMode:g="none",selectedRowKeys:b={},onSelectedRowKeysChanged:E})=>{const y=(0,d.useMemo)((()=>{const e={};return Object.keys(b).forEach((t=>{e[t]=b[t]})),e}),[b]),[f,v]=(0,d.useState)(null),C=(0,d.useCallback)((e=>{E&&("single"===g?e in y&&y[e]?E([]):E([e+""]):"multiple"===g&&E(Object.keys(y).filter((t=>t!=e&&y[t])).concat(y[e]?[]:[e.toString()])))}),[E,g,y]),Z=(0,d.useCallback)((e=>{v(e)}),[]),S=(0,d.useCallback)(((e,t)=>{t&&n&&n(e),v(null)}),[n]),I=(0,d.useCallback)((e=>{u&&u(e)}),[u]);return p().createElement(l.Z,{className:"NiceTable"},p().createElement(a.Z,null,p().createElement(s.Z,null,p().createElement(r.Z,{key:"_first",style:{width:0}}),t.map((e=>p().createElement(r.Z,{key:e.key},p().createElement("span",null,e.label)))))),p().createElement(o.Z,null,e.map((e=>p().createElement(s.Z,{key:e.key},p().createElement(r.Z,null,n&&(f===e.key?p().createElement(w,{title:c||"",onConfirmDeleteRow:S,rowKey:e.key}):p().createElement(k,{title:c||"",onDeleteRow:Z,rowKey:e.key})),u&&p().createElement(h,{title:m||"",onEditRow:I,rowKey:e.key}),"none"!==g&&p().createElement(i.Z,{checked:y[e.key]||!1,onClick:()=>C(e.key)})),t.map((t=>{return p().createElement(r.Z,{key:t.key},p().createElement("span",null,0==(n=e.columnValues[t.key])?n:n?"object"==typeof n?n.element?n.element:n.text||"":n:""));var n})))))))}},78356:(e,t,n)=>{"use strict";n.d(t,{Z:()=>K});var l=n(10841),a=n(69297),s=n.n(a),r=n(95849),o=n(94234),i=n(7424),c=n(5443),u=n(20864);const m=()=>{const[e,t]=(0,a.useState)([]),n=(0,a.useContext)(c.Zo);return(0,a.useEffect)((()=>{const e=setInterval((()=>{const e=n.getHitherJobs();t(e)}),1e3);return()=>{clearInterval(e)}}),[n]),{pendingJobs:e.filter((e=>"pending"===e.status)),runningJobs:e.filter((e=>"running"===e.status)),finishedJobs:e.filter((e=>"finished"===e.status)),erroredJobs:e.filter((e=>"error"===e.status)),allJobs:e}},d=({onClick:e})=>{const{pendingJobs:t,runningJobs:n,finishedJobs:l,erroredJobs:a}=m(),r=t.length,o=n.length,i=l.length,c=a.length,d=`Jobs: ${r} pending | ${o} running | ${i} finished | ${c} errored`,p=c>0?s().createElement("span",null,":",s().createElement("span",{style:{color:"pink"}},c)):s().createElement("span",null);return s().createElement(u.Z,{onClick:e,color:"white"},s().createElement("span",{title:d,style:{fontFamily:"courier"}},r,":",o,":",i,p))};var p=n(39110),g=n(62275),b=n(39518),E=n(54193);const k=({color:e})=>{const{websocketStatus:t,onReconnectWebsocket:n}=(0,a.useContext)(c.AL),{icon:l,title:r}=(0,a.useMemo)((()=>{switch(t){case"waiting":return{icon:s().createElement(g.Z,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:s().createElement(b.Z,{style:{color:e}}),title:"Connected"};case"disconnected":return{icon:s().createElement(E.Z,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[t,e]),o=(0,a.useCallback)((()=>{"disconnected"===t&&n()}),[t,n]);return s().createElement(p.Z,{title:r,onClick:o},l)};var w=n(55205);const h=({onOpenSettings:e,color:t})=>{const{icon:n,title:l}=(0,a.useMemo)((()=>({icon:s().createElement(w.Z,null),title:"Open settings"})),[]),r=(0,a.useCallback)((()=>{e()}),[e]);return s().createElement(p.Z,{style:{color:t},title:l,onClick:r},n)},y={paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold",cursor:"pointer"},f=({onOpenSettings:e,onOpenJobMonitor:t,workspaceRouteDispatch:n,logo:l})=>{const r=(0,a.useCallback)((()=>{n({type:"gotoRecordingsPage"})}),[n]);return s().createElement(o.Z,{position:"static",style:{height:50,color:"white"}},s().createElement(i.Z,null,l&&s().createElement("img",{src:l,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:r}),"   ",s().createElement("div",{style:y,onClick:r},"Labbox Ephys"),s().createElement("span",{style:{marginLeft:"auto"}}),s().createElement("span",{style:{paddingBottom:0,color:"white"}},s().createElement(h,{onOpenSettings:e,color:"white"}),s().createElement(k,{color:"white"}),s().createElement(d,{onClick:t}))))};var v=n(32772),C=n(95898),Z=n(22682),S=n(37450),I=n(62198),j=n(2197),O=n(92378);const x=({job:e})=>{const t=e.kwargs&&R(e.kwargs).length>50,n=e.kwargs&&R(e.kwargs).length>1e3,[l,r]=(0,a.useState)(!t),o=e.result&&R(e.result).length>50,i=e.result&&R(e.result).length>1e3,[c,u]=(0,a.useState)(!o),m=l?s().createElement("div",null,t&&s().createElement(C.Z,{onClick:()=>r(!1)},"Collapse"),s().createElement("pre",null,e.kwargs?R(e.kwargs):"")):n?s().createElement(C.Z,{onClick:()=>{console.info(e.kwargs)},title:"Write input argumetns to the browser developer tools console"},"Write input arguments to console"):s().createElement(C.Z,{onClick:()=>{console.info(e.kwargs),r(!0)}},"Expand"),d=c?s().createElement("div",null,o&&s().createElement(C.Z,{onClick:()=>u(!1)},"Collapse"),s().createElement("pre",null,e.result?R(e.result):"")):i?s().createElement(C.Z,{onClick:()=>{console.info(e.result)},title:"Write result to the browser developer tools console"},"Write result to console"):s().createElement(C.Z,{onClick:()=>{console.info(e.result),u(!0)}},"Expand"),p=[{label:"Job ID",value:e.jobId},{label:"Function name",value:e.functionName},{label:"Input arguments",value:m},{label:"Status",value:e.status},{label:"Started",value:e.timestampStarted?M(new Date(e.timestampStarted)):""},{label:"Finished",value:e.timestampFinished?M(new Date(e.timestampFinished)):""},{label:"Result",value:d},{label:"Error message",value:e.error_message}];return s().createElement("div",null,s().createElement(Z.Z,{className:"NiceTable"},s().createElement(S.Z,null),s().createElement(I.Z,null,p.map((e=>s().createElement(j.Z,{key:e.label},s().createElement(O.Z,null,e.label),s().createElement(O.Z,null,e.value)))))))};function R(e){return JSON.stringify(e,null,4)}function M(e){let t="";var n,l;return n=e,l=new Date,(n.getFullYear()!==l.getFullYear()||n.getMonth()!==l.getMonth()||n.getDate()!==l.getDate())&&(t+=`${e.getMonth()+1}/${e.getDate()}/${e.getFullYear()}} `),t+=`${e.toLocaleTimeString()}`,t}const U=({job:e,onBack:t})=>s().createElement("div",null,s().createElement("p",null,s().createElement(u.Z,{onClick:t},"Back to jobs")),s().createElement(x,{job:e}));var D=n(67539),F=n(23801);function J(e){let t="";var n,l;return n=e,l=new Date,(n.getFullYear()!==l.getFullYear()||n.getMonth()!==l.getMonth()||n.getDate()!==l.getDate())&&(t+=`${e.getMonth()+1}/${e.getDate()}/${e.getFullYear()}} `),t+=`${e.toLocaleTimeString()}`,t}const T=({onClick:e})=>s().createElement(p.Z,{title:"Cancel job",onClick:e},s().createElement(F.Z,null)),N=({jobs:e,onViewJob:t,onCancelJob:n})=>{const l=(0,a.useMemo)((()=>[{key:"jobId",label:"Job"},{key:"functionName",label:"Function"},{key:"status",label:"Status"},{key:"started",label:"Started"},{key:"finished",label:"Finished"},{key:"message",label:"Message"}]),[]),r=(0,a.useMemo)((()=>[...e].sort(((e,t)=>"running"===e.status&&"running"!==t.status?-1:"running"===t.status&&"running"!==e.status?1:e.timestampStarted&&t.timestampStarted?e.timestampStarted<t.timestampStarted?1:t.timestampStarted<e.timestampStarted?-1:0:0))),[e]),o=(0,a.useMemo)((()=>r.map((e=>({key:e.jobId||"null",columnValues:{jobId:{text:e.jobId,element:s().createElement(u.Z,{onClick:()=>{t&&t(e)}},e.jobId)},functionName:{text:e.functionName},status:{text:e.status,element:"running"===e.status?s().createElement("span",null,s().createElement("span",null,e.status," "),s().createElement(T,{onClick:()=>{n&&n(e)}})):s().createElement("span",null,e.status)},started:{text:e.timestampStarted?J(new Date(e.timestampStarted)):""},finished:{text:e.timestampFinished?J(new Date(e.timestampFinished)):""},message:{text:e.error_message||""}}})))),[r]);return s().createElement(D.Z,{rows:o,columns:l})},V=(0,v.Z)((e=>({paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}))),L=()=>{const e=V(),{allJobs:t}=m(),[n,l]=(0,a.useState)(null),r=(0,a.useCallback)((e=>{l(e)}),[]),o=(0,a.useCallback)((()=>{}),[]),i=(0,a.useCallback)((()=>{l(null)}),[]);return s().createElement("div",{className:e.paper,style:{zIndex:9999}},s().createElement("h2",null,"Job Monitor"),n?s().createElement(U,{job:n,onBack:i}):s().createElement(N,{jobs:t,onViewJob:r,onCancelJob:o}))},$=(0,v.Z)((e=>({paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}))),W=({workspaceUri:e,version:t})=>{const n=$(),{serverInfo:l}=(0,a.useContext)(c.AL);return s().createElement("div",{className:n.paper,style:{zIndex:9999}},s().createElement("h2",null,"Labbox Ephys ",t),s().createElement(Z.Z,null,s().createElement(j.Z,null,s().createElement(O.Z,null,"Workspace URI"),s().createElement(O.Z,null,e||"")),s().createElement(j.Z,null,s().createElement(O.Z,null,"Kachery node ID"),s().createElement(O.Z,null,l?l.nodeId:"")),s().createElement(j.Z,null,s().createElement(O.Z,null,"Default feed ID"),s().createElement(O.Z,null,l?l.defaultFeedId:""))))};function _(){const{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}const K=({workspace:e,workspaceDispatch:t,workspaceRoute:n,workspaceRouteDispatch:o,version:i,width:c,height:u})=>{const{width:m,height:d}=function(){const[e,t]=(0,a.useState)(_());return(0,a.useEffect)((()=>{function e(){t(_())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),p=(u||d)-52-2,g=(c||m)-0-2,b=(0,r.FO)().filter((e=>"WorkspaceView"===e.name))[0];if(!b)throw Error("Unable to find workspace view plugin");const[E,k]=(0,a.useState)(!1),[w,h]=(0,a.useState)(!1),y=(0,a.useCallback)((()=>{k(!0)}),[]),v=(0,a.useCallback)((()=>{h(!0)}),[]),C=(0,a.useCallback)((()=>{k(!1)}),[]),Z=(0,a.useCallback)((()=>{h(!1)}),[]);return s().createElement("div",{style:{margin:0}},s().createElement(f,{onOpenSettings:y,onOpenJobMonitor:v,workspaceRouteDispatch:o}),s().createElement("div",{style:{position:"absolute",top:52}},s().createElement(b.component,{width:g,height:p,workspace:e,workspaceDispatch:t,workspaceRoute:n,workspaceRouteDispatch:o})),s().createElement(l.Z,{open:E,onClose:C,style:{zIndex:9999}},s().createElement("span",null,s().createElement(W,{workspace:e,workspaceUri:n.workspaceUri,version:i}))),s().createElement(l.Z,{open:w,onClose:Z,style:{zIndex:9999}},s().createElement("span",null,s().createElement(L,null))))}},95849:(e,t,n)=>{"use strict";n.d(t,{kN:()=>c,GI:()=>u,CC:()=>i,Zl:()=>r,_S:()=>b,SF:()=>m,fG:()=>k,fB:()=>E,Sd:()=>g,FO:()=>w});var l=n(5443),a=n(69297);const s=(e,t)=>{if(e.min<=t&&t<e.max)return e;const n=e.max-e.min,l=Math.max(0,Math.floor(t-n/2));return{min:l,max:l+n}},r=(e,t)=>{var n,l,a,r;if("SetRecordingSelection"===t.type)return Object.assign({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{selectedElectrodeIds:t.selectedElectrodeIds.filter((t=>!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)))});if("SetVisibleElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((e=>t.visibleElectrodeIds.includes(e))):void 0});if("SetCurrentTimepoint"===t.type)return Object.assign(Object.assign({},e),{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?s(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object.assign(Object.assign({},e),{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){const a=9e6,s=e.currentTimepoint,r=e.timeRange;if(!r)return e;const i=null!==(n=t.direction)&&void 0!==n?n:"in",c=null!==(l=t.factor)&&void 0!==l?l:1.4,u="out"===i?1/c:c;if((r.max-r.min)/u>a)return e;let m;m=void 0===s||s<r.min?r.min:s>r.max?r.max:s;const d=o(r,u,m);return Object.assign(Object.assign({},e),{timeRange:d})}if("SetAmpScaleFactor"===t.type)return Object.assign(Object.assign({},e),{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){const n=null!==(a=t.direction)&&void 0!==a?a:"up",l=null!==(r=t.multiplier)&&void 0!==r?r:1.4,s="down"===n?1/l:l;return Object.assign(Object.assign({},e),{ampScaleFactor:(e.ampScaleFactor||1)*s})}return"SetCurrentTimepointVelocity"===t.type?Object.assign(Object.assign({},e),{animation:Object.assign(Object.assign({},e.animation||{}),{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object.assign(Object.assign({},e),{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},o=(e,t,n)=>{const l=n+(e.min-n)/t,a=n+(e.max-n)/t;return{min:Math.floor(l),max:Math.floor(a)}},i=(e,t)=>((t||{}).mergeGroups||[]).filter((t=>t.includes(e)))[0]||null,c=(e,t,n)=>n&&i(e,t)||e,u=(e,t)=>{const n=i(e,t);return!n||Math.min(...n)===e},m=(e,t)=>"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:t.selectedUnitIds.filter((t=>{var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>{var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?((e,t)=>{const n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object.assign(Object.assign({},e),{selectedUnitIds:(e.selectedUnitIds||[]).filter((e=>e!==n))}):Object.assign(Object.assign({},e),{selectedUnitIds:[...e.selectedUnitIds||[],n]}):Object.assign(Object.assign({},e),{selectedUnitIds:[n]})})(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?d(Object.assign(Object.assign({},e),{applyMerges:!e.applyMerges}),t.curation):r(e,t),d=(e,t)=>e.applyMerges&&t?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>u(e,t))):void 0}):e,p=e=>e.filter((e=>!e.disabled&&!e.development)),g=e=>p(e).filter((e=>"SortingView"===e.type)).map((e=>e)),b=e=>p(e).filter((e=>"RecordingView"===e.type)).map((e=>e)),E=e=>p(e).filter((e=>"SortingUnitView"===e.type)).map((e=>e)),k=e=>p(e).filter((e=>"SortingUnitMetric"===e.type)).map((e=>e)),w=()=>{const e=(0,l._m)();return(0,a.useMemo)((()=>e.filter((e=>"WorkspaceView"===e.type)).map((e=>e))),[e])}}}]);