Usage
=====

Modern Relay takes all of its configuration from its ``config.yaml`` file located in the projects root directory. Let's
look at an example ``config.yaml`` file and break down what options are available:

.. literalinclude:: ../config.yaml
    :language: YAML

Logging
-------

There are three variables that need to be set here: ``log_level``, ``log_file_name``, and ``log_file_dir``. Its
recommended that you keep the log level at ``INFO`` or higher. If you're submitting a bug report, please drop it to DEBUG.
``log_file_name`` and ``log_file_dir`` are self-explanatory. They allow you to move the log files around to somewhere
that sparks joy.

TLS
---

This is the section that sets up and enables STARTTLS. If you set ``required`` to yes, all clients will need to
initiate STARTTLS before the client can send mail. You will need to provide an X.509 key pair in order to make it work.

Networking
----------

Set your port and IP address that you wish to bind to.

Files
-----

Set the location of the mail spool directory. If mail is unable to be sent via the appropriate delivery agent, it will
be saved the disk in this location and retried later.

Peers
-----

This is where the heavy lifting of the configuration happens. List all peers in cidr notation. Each peer is either a host
or a pool of hosts in a subnet that are allowed to relay through your server. Each entry needs to have the following
information: ``agent``, ``destination``, and ``authenticated``. For now, ``agent`` will likely be the GraphDeliveryAgent.
``destination`` allows you to control which domains this peer can send to. If you set it to ``all`` then there are no
restrictions. If you make a list of domains, or even just a list of a single domain, Modern Relay will only allow relay
to what you've specified. It will fail to send anywhere else. Finally, ``authenticated`` is a yes/no option that specifies
whether to require the use of SMTP Auth. SMTP Auth username/password pairs are generated by ``make_users.py``. Example
usage::

    $ make_user.py -users 'SuperAdmin'='PrintersAreMyJobSecurity' 'AnotherUser'='password'

You can place the ``modernrelay.db`` file it generates in the project root folder. Modern Relay will load that database
at start up and use it for client authentication.
